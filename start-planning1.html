<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡ Ùˆ Ù‡ÙØªÚ¯ÛŒ Ø¨Ø¯ÙˆÙ† Ø§Ø³ØªØ±Ø³ - Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ù‚Ø§Ø¨Ù„ Ù†ØµØ¨">
  <meta name="theme-color" content="#10B981">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ² Ø¢Ø±Ø§Ù…">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ² Ø¢Ø±Ø§Ù…">
  <meta name="msapplication-TileColor" content="#10B981">
  <meta name="msapplication-tap-highlight" content="no">
  
  <title>Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ² Ø¢Ø±Ø§Ù…</title>
  
  <!-- Manifest for PWA -->
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogItio2LHZhtin2YXZh+KAjNix24zYsiDYotix2KfZhSIsCiAgInNob3J0X25hbWUiOiAi2KLYsdin2YUiLAogICJkZXNjcmlwdGlvbiI6ICLYqNix2YbYp9mF2YfigIzYsduM2LLbjCDYsdinINiz2KfYr9mHINmIINio2K/ZiNmGINin2LPYqtix2LMg24zYp9ivINio2q/bjNixIiwKICAic3RhcnRfdXJsIjogIi4iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNFQ0ZERjUiLAogICJ0aGVtZV9jb2xvciI6ICIjMTBCOTgxIiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQiLAogICJjYXRlZ29yaWVzIjogWyJwcm9kdWN0aXZpdHkiLCAibGlmZXN0eWxlIl0sCiAgImxhbmciOiAiZmEiLAogICJkaXIiOiAicnRsIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLDxzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB2aWV3Qm94PScwIDAgNTEyIDUxMic+PGNpcmNsZSBjeD0nMjU2JyBjeT0nMjU2JyByPScyNTYnIGZpbGw9JyUyMzEwQjk4MScvPjx0ZXh0IHg9JzI1NicgeT0nMzIwJyBmb250LXNpemU9JzI1MCcgdGV4dC1hbmNob3I9J21pZGRsZScgZmlsbD0nd2hpdGUnPvCfjL88L3RleHQ+PC9zdmc+IiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIiwKICAgICAgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIgogICAgfQogIF0KfQ==">
  
  <!-- Icons -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ¿</text></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><circle cx='256' cy='256' r='256' fill='%2310B981'/><text x='256' y='320' font-size='250' text-anchor='middle' fill='white'>ğŸŒ¿</text></svg>">
  
  <!-- Fonts -->
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
  
  <style>
    :root {
      --primary-50: #ECFDF5;
      --primary-100: #D1FAE5;
      --primary-200: #A7F3D0;
      --primary-300: #6EE7B7;
      --primary-400: #34D399;
      --primary-500: #10B981;
      --primary-600: #059669;
      --primary-700: #047857;
      --primary-800: #065F46;
      --primary-900: #064E3B;
      
      --gray-50: #F9FAFB;
      --gray-100: #F3F4F6;
      --gray-200: #E5E7EB;
      --gray-300: #D1D5DB;
      --gray-400: #9CA3AF;
      --gray-500: #6B7280;
      --gray-600: #4B5563;
      --gray-700: #374151;
      --gray-800: #1F2937;
      --gray-900: #111827;
      
      --success: #10B981;
      --warning: #F59E0B;
      --danger: #EF4444;
      --info: #3B82F6;
      
      --bg-primary: #FFFFFF;
      --bg-secondary: var(--gray-50);
      --bg-tertiary: var(--gray-100);
      --text-primary: var(--gray-900);
      --text-secondary: var(--gray-600);
      --text-tertiary: var(--gray-400);
      --border-color: var(--gray-200);
      
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
      
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --radius-2xl: 1.5rem;
      --radius-full: 9999px;
      
      --transition-fast: 150ms ease;
      --transition-normal: 250ms ease;
      
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }
    
    [data-theme="dark"] {
      --bg-primary: var(--gray-900);
      --bg-secondary: var(--gray-800);
      --bg-tertiary: var(--gray-700);
      --text-primary: var(--gray-50);
      --text-secondary: var(--gray-400);
      --text-tertiary: var(--gray-500);
      --border-color: var(--gray-700);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html {
      height: 100%;
      overflow: hidden;
    }
    
    body {
      font-family: 'Vazirmatn', system-ui, -apple-system, sans-serif;
      background: var(--bg-secondary);
      color: var(--text-primary);
      line-height: 1.6;
      font-size: 15px;
      height: 100%;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior: none;
    }
    
    /* App Container */
    .app {
      height: 100%;
      display: flex;
      flex-direction: column;
      max-width: 100%;
      margin: 0 auto;
      background: var(--bg-primary);
      position: relative;
    }
    
    @media (min-width: 768px) {
      .app {
        max-width: 420px;
        box-shadow: var(--shadow-lg);
        border-radius: 0;
      }
    }
    
    /* Status Bar */
    .status-bar {
      height: var(--safe-top);
      background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
      flex-shrink: 0;
    }
    
    /* Header */
    .header {
      background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
      color: white;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
      z-index: 100;
    }
    
    .header-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.1rem;
      font-weight: 700;
    }
    
    .header-actions {
      display: flex;
      gap: 8px;
    }
    
    .header-btn {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-lg);
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
    }
    
    .header-btn:active {
      transform: scale(0.95);
      background: rgba(255,255,255,0.3);
    }
    
    /* Main Content */
    .main {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      padding: 16px;
      padding-bottom: calc(80px + var(--safe-bottom));
    }
    
    /* Cards */
    .card {
      background: var(--bg-primary);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
      padding: 20px;
      margin-bottom: 16px;
    }
    
    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .card-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
    }
    
    .card-icon.green { background: var(--primary-100); }
    .card-icon.blue { background: #DBEAFE; }
    .card-icon.purple { background: #EDE9FE; }
    .card-icon.yellow { background: #FEF3C7; }
    .card-icon.pink { background: #FCE7F3; }
    
    [data-theme="dark"] .card-icon.green { background: var(--primary-900); }
    [data-theme="dark"] .card-icon.blue { background: #1E3A5F; }
    [data-theme="dark"] .card-icon.purple { background: #3B2F63; }
    [data-theme="dark"] .card-icon.yellow { background: #4A3728; }
    [data-theme="dark"] .card-icon.pink { background: #4A2639; }
    
    .card-title {
      font-size: 1.1rem;
      font-weight: 700;
    }
    
    .card-subtitle {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }
    
    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 20px;
      border-radius: var(--radius-lg);
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all var(--transition-fast);
      font-family: inherit;
      text-decoration: none;
      white-space: nowrap;
    }
    
    .btn:active {
      transform: scale(0.98);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
      color: white;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }
    
    .btn-secondary {
      background: var(--primary-50);
      color: var(--primary-700);
      border: 1px solid var(--primary-200);
    }
    
    [data-theme="dark"] .btn-secondary {
      background: var(--primary-900);
      color: var(--primary-300);
      border-color: var(--primary-800);
    }
    
    .btn-outline {
      background: transparent;
      color: var(--text-secondary);
      border: 1.5px solid var(--border-color);
    }
    
    .btn-success {
      background: linear-gradient(135deg, var(--success), #059669);
      color: white;
    }
    
    .btn-warning {
      background: linear-gradient(135deg, var(--warning), #D97706);
      color: white;
    }
    
    .btn-danger {
      background: var(--danger);
      color: white;
    }
    
    .btn-block {
      width: 100%;
    }
    
    .btn-lg {
      padding: 16px 24px;
      font-size: 1.05rem;
    }
    
    .btn-sm {
      padding: 8px 12px;
      font-size: 0.85rem;
    }
    
    /* Inputs */
    .input, .textarea, .select {
      width: 100%;
      padding: 12px 16px;
      border: 1.5px solid var(--border-color);
      border-radius: var(--radius-lg);
      font-size: 0.95rem;
      font-family: inherit;
      background: var(--bg-primary);
      color: var(--text-primary);
      transition: all var(--transition-fast);
    }
    
    .input:focus, .textarea:focus, .select:focus {
      outline: none;
      border-color: var(--primary-500);
      box-shadow: 0 0 0 3px var(--primary-100);
    }
    
    [data-theme="dark"] .input:focus,
    [data-theme="dark"] .textarea:focus,
    [data-theme="dark"] .select:focus {
      box-shadow: 0 0 0 3px var(--primary-900);
    }
    
    .input::placeholder, .textarea::placeholder {
      color: var(--text-tertiary);
    }
    
    .textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    .input-group {
      margin-bottom: 16px;
    }
    
    .input-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    /* Chips */
    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 8px 12px;
      background: var(--bg-tertiary);
      border: 1.5px solid transparent;
      border-radius: var(--radius-full);
      cursor: pointer;
      font-size: 0.85rem;
      transition: all var(--transition-fast);
    }
    
    .chip:active {
      transform: scale(0.95);
    }
    
    .chip.selected {
      background: var(--primary-500);
      color: white;
      border-color: var(--primary-500);
    }
    
    /* Tags */
    .tag {
      display: inline-flex;
      padding: 2px 8px;
      background: var(--primary-100);
      color: var(--primary-700);
      border-radius: var(--radius-sm);
      font-size: 0.7rem;
      font-weight: 600;
    }
    
    .tag.blue {
      background: #DBEAFE;
      color: #1D4ED8;
    }
    
    [data-theme="dark"] .tag {
      background: var(--primary-900);
      color: var(--primary-300);
    }
    
    [data-theme="dark"] .tag.blue {
      background: #1E3A5F;
      color: #60A5FA;
    }
    
    /* Progress */
    .progress {
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-full);
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-400), var(--primary-500));
      border-radius: var(--radius-full);
      transition: width var(--transition-normal);
    }
    
    /* Task Item */
    .task-item {
      display: flex;
      gap: 12px;
      padding: 16px;
      background: var(--bg-secondary);
      border: 1.5px solid var(--border-color);
      border-radius: var(--radius-lg);
      margin-bottom: 12px;
      transition: all var(--transition-fast);
    }
    
    .task-item.completed {
      background: var(--primary-50);
      border-color: var(--primary-200);
    }
    
    [data-theme="dark"] .task-item.completed {
      background: var(--primary-900);
      border-color: var(--primary-800);
    }
    
    .task-item.completed .task-title {
      text-decoration: line-through;
      color: var(--text-tertiary);
    }
    
    .checkbox {
      width: 24px;
      height: 24px;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      flex-shrink: 0;
      transition: all var(--transition-fast);
      font-size: 0.75rem;
      color: transparent;
      margin-top: 2px;
    }
    
    .checkbox.checked {
      background: var(--primary-500);
      border-color: var(--primary-500);
      color: white;
    }
    
    .task-content {
      flex: 1;
      min-width: 0;
    }
    
    .task-title {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 4px;
    }
    
    .task-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    
    .task-delete {
      color: var(--text-tertiary);
      cursor: pointer;
      padding: 4px;
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
    }
    
    .task-delete:active {
      color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }
    
    /* Subtasks */
    .subtasks {
      margin-top: 12px;
      padding-right: 16px;
    }
    
    .subtask-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: var(--bg-primary);
      border-radius: var(--radius-md);
      margin-bottom: 8px;
      font-size: 0.85rem;
    }
    
    .subtask-checkbox {
      width: 18px;
      height: 18px;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 0.65rem;
      flex-shrink: 0;
      transition: all var(--transition-fast);
    }
    
    .subtask-checkbox.checked {
      background: var(--primary-500);
      border-color: var(--primary-500);
      color: white;
    }
    
    .subtask-add {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    
    .subtask-add .input {
      padding: 8px 12px;
      font-size: 0.85rem;
    }
    
    /* Brain Item */
    .brain-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      margin-bottom: 8px;
      font-size: 0.9rem;
    }
    
    .brain-item-text {
      flex: 1;
    }
    
    .brain-item-actions {
      display: flex;
      gap: 4px;
    }
    
    .brain-item-btn {
      padding: 4px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    
    .brain-item-btn:active {
      background: var(--bg-tertiary);
    }
    
    /* Habit Card */
    .habit-card {
      background: linear-gradient(135deg, var(--primary-50), var(--primary-100));
      border: 1px solid var(--primary-200);
      border-radius: var(--radius-lg);
      padding: 16px;
      margin-bottom: 12px;
      position: relative;
    }
    
    [data-theme="dark"] .habit-card {
      background: linear-gradient(135deg, var(--primary-900), var(--primary-800));
      border-color: var(--primary-700);
    }
    
    .habit-card-delete {
      position: absolute;
      top: 8px;
      left: 8px;
      color: var(--text-tertiary);
      cursor: pointer;
      font-size: 0.8rem;
    }
    
    /* WOOP Card */
    .woop-card {
      background: linear-gradient(135deg, #FEF3C7, #FDE68A);
      border: 1px solid #FCD34D;
      border-radius: var(--radius-lg);
      padding: 16px;
      margin-bottom: 12px;
    }
    
    [data-theme="dark"] .woop-card {
      background: linear-gradient(135deg, #78350F, #92400E);
      border-color: #B45309;
    }
    
    /* Flow Steps */
    .flow-container {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-xl);
      padding: 20px;
      margin-bottom: 16px;
    }
    
    .flow-steps {
      display: flex;
      justify-content: space-between;
      position: relative;
    }
    
    .flow-steps::before {
      content: '';
      position: absolute;
      top: 22px;
      right: 50px;
      left: 50px;
      height: 2px;
      background: var(--border-color);
    }
    
    .flow-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 1;
      cursor: pointer;
    }
    
    .flow-step-icon {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--bg-primary);
      border: 2px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      transition: all var(--transition-fast);
    }
    
    .flow-step.active .flow-step-icon {
      background: var(--primary-500);
      border-color: var(--primary-500);
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }
    
    .flow-step.done .flow-step-icon {
      background: var(--primary-100);
      border-color: var(--primary-300);
    }
    
    .flow-step-label {
      font-size: 0.75rem;
      color: var(--text-tertiary);
      margin-top: 8px;
      font-weight: 500;
    }
    
    .flow-step.active .flow-step-label {
      color: var(--primary-600);
      font-weight: 600;
    }
    
    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }
    
    @media (max-width: 360px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    .stat-box {
      text-align: center;
      padding: 12px;
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
    }
    
    .stat-number {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-600);
    }
    
    .stat-label {
      font-size: 0.7rem;
      color: var(--text-secondary);
      margin-top: 4px;
    }
    
    /* Banner */
    .banner {
      background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
      color: white;
      border-radius: var(--radius-xl);
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }
    
    .banner-title {
      font-size: 1.15rem;
      font-weight: 700;
    }
    
    .banner-subtitle {
      font-size: 0.85rem;
      opacity: 0.9;
      margin-top: 4px;
    }
    
    .banner-streak {
      text-align: left;
    }
    
    .banner-streak-number {
      font-size: 1.75rem;
      font-weight: 700;
    }
    
    .banner-streak-label {
      font-size: 0.7rem;
      opacity: 0.8;
    }
    
    /* Accordion */
    .accordion {
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      margin-bottom: 12px;
      overflow: hidden;
      background: var(--bg-primary);
    }
    
    .accordion-header {
      padding: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: 600;
      font-size: 0.95rem;
    }
    
    .accordion-icon {
      transition: transform var(--transition-fast);
    }
    
    .accordion.open .accordion-icon {
      transform: rotate(180deg);
    }
    
    .accordion-body {
      padding: 0 16px 16px;
      display: none;
      font-size: 0.9rem;
      line-height: 1.8;
      color: var(--text-secondary);
    }
    
    .accordion.open .accordion-body {
      display: block;
    }
    
    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 16px;
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-normal);
    }
    
    .modal.show {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-content {
      background: var(--bg-primary);
      border-radius: var(--radius-2xl);
      max-width: 400px;
      width: 100%;
      padding: 24px;
      transform: scale(0.9) translateY(20px);
      transition: transform var(--transition-normal);
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal.show .modal-content {
      transform: scale(1) translateY(0);
    }
    
    .modal-icon {
      width: 72px;
      height: 72px;
      margin: 0 auto 16px;
      background: linear-gradient(135deg, var(--primary-100), var(--primary-200));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
    }
    
    .modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 8px;
    }
    
    .modal-subtitle {
      font-size: 0.9rem;
      color: var(--text-secondary);
      text-align: center;
      margin-bottom: 20px;
    }
    
    /* Backup Box */
    .backup-box {
      background: linear-gradient(135deg, #FEF3C7, #FDE68A);
      border: 2px solid #FCD34D;
      border-radius: var(--radius-lg);
      padding: 16px;
      margin: 16px 0;
      text-align: center;
    }
    
    [data-theme="dark"] .backup-box {
      background: linear-gradient(135deg, #78350F, #92400E);
      border-color: #B45309;
    }
    
    .backup-box code {
      display: block;
      background: rgba(0, 0, 0, 0.1);
      padding: 8px 12px;
      border-radius: var(--radius-md);
      margin-top: 8px;
      font-family: monospace;
      font-size: 0.85rem;
      direction: ltr;
    }
    
    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-primary);
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: space-around;
      padding: 8px 4px;
      padding-bottom: calc(8px + var(--safe-bottom));
      z-index: 100;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08);
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px 12px;
      border-radius: var(--radius-lg);
      cursor: pointer;
      color: var(--text-tertiary);
      transition: all var(--transition-fast);
      min-width: 56px;
    }
    
    .nav-item:active {
      transform: scale(0.95);
    }
    
    .nav-item.active {
      color: var(--primary-600);
      background: var(--primary-50);
    }
    
    [data-theme="dark"] .nav-item.active {
      background: var(--primary-900);
    }
    
    .nav-icon {
      font-size: 1.35rem;
      margin-bottom: 2px;
    }
    
    .nav-label {
      font-size: 0.65rem;
      font-weight: 600;
    }
    
    /* Theme Toggle */
    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      cursor: pointer;
    }
    
    .toggle-switch {
      width: 48px;
      height: 26px;
      background: var(--border-color);
      border-radius: var(--radius-full);
      position: relative;
      transition: all var(--transition-fast);
    }
    
    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      background: white;
      border-radius: 50%;
      top: 2px;
      right: 2px;
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-sm);
    }
    
    .toggle-switch.active {
      background: var(--primary-500);
    }
    
    .toggle-switch.active::after {
      right: 24px;
    }
    
    /* Step Dots */
    .step-dots {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 24px;
    }
    
    .step-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--border-color);
      transition: all var(--transition-fast);
    }
    
    .step-dot.active {
      background: var(--primary-500);
      width: 28px;
      border-radius: 5px;
    }
    
    .step-dot.done {
      background: var(--primary-300);
    }
    
    /* Time Blocks */
    .time-blocks {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    
    .time-block {
      padding: 16px;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-lg);
      text-align: center;
      cursor: pointer;
      background: var(--bg-primary);
      transition: all var(--transition-fast);
    }
    
    .time-block:active {
      transform: scale(0.98);
    }
    
    .time-block.selected {
      background: var(--primary-50);
      border-color: var(--primary-500);
    }
    
    [data-theme="dark"] .time-block.selected {
      background: var(--primary-900);
    }
    
    .time-block-icon {
      font-size: 1.75rem;
      margin-bottom: 8px;
    }
    
    .time-block-label {
      font-size: 0.9rem;
      font-weight: 600;
    }
    
    /* AI Box */
    .ai-box {
      background: linear-gradient(135deg, #EDE9FE, #FCE7F3);
      border: 2px solid #C4B5FD;
      border-radius: var(--radius-xl);
      padding: 20px;
      text-align: center;
    }
    
    [data-theme="dark"] .ai-box {
      background: linear-gradient(135deg, #4C1D95, #831843);
      border-color: #7C3AED;
    }
    
    .ai-icon {
      font-size: 3rem;
      margin-bottom: 12px;
    }
    
    .prompt-box {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 16px;
      font-size: 0.85rem;
      line-height: 1.9;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      text-align: right;
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 32px;
      color: var(--text-tertiary);
    }
    
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 12px;
      opacity: 0.5;
    }
    
    .empty-state-text {
      font-size: 0.9rem;
    }
    
    /* Result Box */
    .result-box {
      background: linear-gradient(135deg, var(--primary-50), var(--primary-100));
      border: 1px solid var(--primary-200);
      border-radius: var(--radius-lg);
      padding: 16px;
    }
    
    [data-theme="dark"] .result-box {
      background: linear-gradient(135deg, var(--primary-900), var(--primary-800));
      border-color: var(--primary-700);
    }
    
    /* Offline Indicator */
    .offline-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--warning);
      color: white;
      text-align: center;
      padding: 8px;
      font-size: 0.8rem;
      font-weight: 600;
      z-index: 9999;
      transform: translateY(-100%);
      transition: transform var(--transition-normal);
    }
    
    .offline-bar.show {
      transform: translateY(0);
    }
    
    /* Install Banner */
    .install-banner {
      background: linear-gradient(135deg, var(--info), #1D4ED8);
      color: white;
      padding: 16px;
      border-radius: var(--radius-xl);
      margin-bottom: 16px;
      display: none;
      align-items: center;
      gap: 12px;
    }
    
    .install-banner.show {
      display: flex;
    }
    
    .install-banner-text {
      flex: 1;
    }
    
    .install-banner-title {
      font-weight: 700;
      font-size: 0.95rem;
    }
    
    .install-banner-subtitle {
      font-size: 0.8rem;
      opacity: 0.9;
    }
    
    .install-banner-btn {
      background: white;
      color: var(--info);
      padding: 8px 16px;
      border-radius: var(--radius-lg);
      font-weight: 700;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      font-family: inherit;
    }
    
    .install-banner-close {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1rem;
    }
    
    /* Page Animation */
    .page {
      display: none;
      animation: fadeIn var(--transition-normal);
    }
    
    .page.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes confetti-fall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    
    /* Utilities */
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .justify-center { justify-content: center; }
    .flex-1 { flex: 1; }
    .flex-wrap { flex-wrap: wrap; }
    .gap-2 { gap: 8px; }
    .gap-3 { gap: 12px; }
    .gap-4 { gap: 16px; }
    .mb-2 { margin-bottom: 8px; }
    .mb-3 { margin-bottom: 12px; }
    .mb-4 { margin-bottom: 16px; }
    .mb-6 { margin-bottom: 24px; }
    .mt-2 { margin-top: 8px; }
    .mt-3 { margin-top: 12px; }
    .mt-4 { margin-top: 16px; }
    .text-center { text-align: center; }
    .text-xs { font-size: 0.75rem; }
    .text-sm { font-size: 0.875rem; }
    .text-lg { font-size: 1.125rem; }
    .text-xl { font-size: 1.25rem; }
    .text-2xl { font-size: 1.5rem; }
    .font-semibold { font-weight: 600; }
    .font-bold { font-weight: 700; }
    .text-secondary { color: var(--text-secondary); }
    .text-tertiary { color: var(--text-tertiary); }
    .hidden { display: none !important; }
    .w-full { width: 100%; }
    .grid { display: grid; }
    .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
    .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
    .py-4 { padding-top: 16px; padding-bottom: 16px; }
    .py-8 { padding-top: 32px; padding-bottom: 32px; }
  </style>
</head>
<body>
  
  <!-- Offline Indicator -->
  <div class="offline-bar" id="offlineBar">
    ğŸ“´ Ø¢ÙÙ„Ø§ÛŒÙ† Ù‡Ø³ØªÛŒØ¯ - ØªØºÛŒÛŒØ±Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
  </div>

  <div class="app">
    <!-- Status Bar Spacer -->
    <div class="status-bar"></div>
    
    <!-- Header -->
    <header class="header" id="appHeader" style="display:none">
      <div class="header-title">
        <span>ğŸŒ¿</span>
        <span>Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ² Ø¢Ø±Ø§Ù…</span>
      </div>
      <div class="header-actions">
        <button class="header-btn" onclick="toggleTheme()" title="ØªØºÛŒÛŒØ± ØªÙ…">
          <span id="themeIcon">ğŸŒ™</span>
        </button>
        <button class="header-btn" onclick="showBackupModal()" title="Ø¨Ú©Ø§Ù¾">
          ğŸ’¾
        </button>
      </div>
    </header>
    
    <!-- Main Content -->
    <main class="main" id="appMain">
      
      <!-- Welcome Modal -->
      <div class="modal" id="welcomeModal">
        <div class="modal-content">
          <div class="modal-icon">ğŸ“‚</div>
          <h2 class="modal-title">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!</h2>
          <p class="modal-subtitle">Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø¨Ú©Ø§Ù¾ Ú¯Ø±ÙØªÛŒØ¯ØŒ Ø§Ù„Ø§Ù† ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
          
          <div class="backup-box">
            <div class="font-semibold text-sm">ğŸ“ ÙØ§ÛŒÙ„ Ø¨Ú©Ø§Ù¾:</div>
            <code>aram-planner-backup.json</code>
          </div>
          
          <div class="flex flex-col gap-3">
            <label class="btn btn-primary btn-block">
              ğŸ“¤ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² ÙØ§ÛŒÙ„
              <input type="file" id="importWelcome" accept=".json" style="display:none">
            </label>
            <button onclick="closeWelcomeModal()" class="btn btn-secondary btn-block">
              âœ¨ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯ÙˆÙ† Ø¨Ú©Ø§Ù¾
            </button>
          </div>
        </div>
      </div>
      
      <!-- Backup Modal -->
      <div class="modal" id="backupModal">
        <div class="modal-content">
          <div class="modal-icon" style="background: linear-gradient(135deg, #FEF3C7, #FDE68A);">ğŸ’¾</div>
          <h2 class="modal-title">Ø°Ø®ÛŒØ±Ù‡ Ø¨Ú©Ø§Ù¾</h2>
          
          <div class="backup-box">
            <div class="font-semibold text-sm">ğŸ“ ÙØ§ÛŒÙ„ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒØ´Ù‡ Ø¯Ø±:</div>
            <code>ğŸ“± Downloads / Ø¯Ø§Ù†Ù„ÙˆØ¯Ù‡Ø§</code>
            <p class="text-xs mt-2">Ù†Ø§Ù… ÙØ§ÛŒÙ„: <strong>aram-planner-backup.json</strong></p>
          </div>
          
          <div class="flex flex-col gap-3">
            <button onclick="downloadBackup()" class="btn btn-success btn-block">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„</button>
            <button onclick="copyBackup()" class="btn btn-warning btn-block">ğŸ“‹ Ú©Ù¾ÛŒ Ù…ØªÙ†</button>
            <button onclick="closeBackupModal()" class="btn btn-outline btn-block">Ø¨Ø³ØªÙ†</button>
          </div>
        </div>
      </div>
      
      <!-- Start Page -->
      <div id="page-start" class="page active">
        <div class="text-center py-8">
          <div style="font-size: 4rem; margin-bottom: 16px;">ğŸŒ¿</div>
          <h1 class="text-2xl font-bold mb-2">Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ² Ø¢Ø±Ø§Ù…</h1>
          <p class="text-secondary mb-6">Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø³Ø§Ø¯Ù‡ØŒ Ø¨Ø¯ÙˆÙ† Ø§Ø³ØªØ±Ø³</p>
          
          <!-- Install Banner -->
          <div class="install-banner" id="installBanner">
            <div class="install-banner-text">
              <div class="install-banner-title">ğŸ“² Ù†ØµØ¨ Ú©Ù†!</div>
              <div class="install-banner-subtitle">Ø±ÙˆÛŒ Ú¯ÙˆØ´ÛŒ ÛŒØ§ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±</div>
            </div>
            <button class="install-banner-btn" onclick="installApp()">Ù†ØµØ¨</button>
            <button class="install-banner-close" onclick="hideInstallBanner()">âœ•</button>
          </div>
          
          <div class="card text-right">
            <div class="text-lg font-semibold mb-4">Ø§ÛŒÙ† Ø§Ø¨Ø²Ø§Ø± Ú©Ù…Ú©Øª Ù…ÛŒâ€ŒÚ©Ù†Ù‡:</div>
            <div class="flex flex-col gap-3">
              <div class="flex items-center gap-3">
                <span style="font-size: 1.5rem;">ğŸ§ </span>
                <span>Ø°Ù‡Ù†Øª Ø±Ùˆ Ø®Ø§Ù„ÛŒ Ú©Ù†ÛŒ</span>
              </div>
              <div class="flex items-center gap-3">
                <span style="font-size: 1.5rem;">ğŸ¯</span>
                <span>Ø±ÙˆÛŒ Û± ØªØ§ Û³ Ú©Ø§Ø± Ù…Ù‡Ù… ØªÙ…Ø±Ú©Ø² Ú©Ù†ÛŒ</span>
              </div>
              <div class="flex items-center gap-3">
                <span style="font-size: 1.5rem;">ğŸ”—</span>
                <span>Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú© Ø¨Ø³Ø§Ø²ÛŒ</span>
              </div>
              <div class="flex items-center gap-3">
                <span style="font-size: 1.5rem;">ğŸ¤–</span>
                <span>Ø¨Ø§ AI ØªØ­Ù„ÛŒÙ„ Ú©Ù†ÛŒ</span>
              </div>
            </div>
          </div>
          
          <button onclick="startOnboarding()" class="btn btn-primary btn-lg btn-block mt-4">
            Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒÚ©Ù†Ù… â†
          </button>
          <p class="text-xs text-tertiary mt-3">ÙÙ‚Ø· Û² Ø¯Ù‚ÛŒÙ‚Ù‡ ÙˆÙ‚Øª Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù‡</p>
        </div>
      </div>
      
      <!-- Onboarding -->
      <div id="page-onboarding" class="page">
        <div class="step-dots" id="stepDots">
          <div class="step-dot active"></div>
          <div class="step-dot"></div>
          <div class="step-dot"></div>
          <div class="step-dot"></div>
          <div class="step-dot"></div>
        </div>
        
        <!-- Step 1: Name -->
        <div id="step-1" class="step-content">
          <div class="card">
            <div class="card-header">
              <div class="card-icon blue">ğŸ‘‹</div>
              <div>
                <h2 class="card-title">Ø³Ù„Ø§Ù…! Ø§Ø³Ù…Øª Ú†ÛŒÙ‡ØŸ</h2>
                <p class="card-subtitle">Ø¨Ø±Ø§ÛŒ Ø´Ø®ØµÛŒâ€ŒØªØ± Ø´Ø¯Ù† Ø¨Ø±Ù†Ø§Ù…Ù‡</p>
              </div>
            </div>
            <input type="text" id="userName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¹Ù„ÛŒØŒ Ù…Ø±ÛŒÙ…ØŒ ..." class="input text-lg mb-4">
            <button onclick="nextStep(2)" class="btn btn-primary btn-block">Ø§Ø¯Ø§Ù…Ù‡ â†</button>
          </div>
        </div>
        
        <!-- Step 2: Values -->
        <div id="step-2" class="step-content hidden">
          <div class="card">
            <div class="card-header">
              <div class="card-icon pink">ğŸ’</div>
              <div>
                <h2 class="card-title">Ú†ÛŒ Ø¨Ø±Ø§Øª Ù…Ù‡Ù…Ù‡ØŸ</h2>
                <p class="card-subtitle">Û² ØªØ§ Û´ Ø§Ø±Ø²Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†</p>
              </div>
            </div>
            <div id="valuesChips" class="chips mb-4">
              <span class="chip" onclick="toggleChip(this,'values')" data-v="ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ">ğŸ“š ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ</span>
              <span class="chip" onclick="toggleChip(this,'values')" data-v="Ø³Ù„Ø§Ù…ØªÛŒ">ğŸ’ª Ø³Ù„Ø§Ù…ØªÛŒ</span>
              <span class="chip" onclick="toggleChip(this,'values')" data-v="Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡</span>
              <span class="chip" onclick="toggleChip(this,'values')" data-v="Ø¢Ø±Ø§Ù…Ø´">ğŸ§˜ Ø¢Ø±Ø§Ù…Ø´</span>
              <span class="chip" onclick="toggleChip(this,'values')" data-v="Ø®Ù„Ø§Ù‚ÛŒØª">ğŸ¨ Ø®Ù„Ø§Ù‚ÛŒØª</span>
              <span class="chip" onclick="toggleChip(this,'values')" data-v="Ù¾ÛŒØ´Ø±ÙØª">ğŸ“ˆ Ù¾ÛŒØ´Ø±ÙØª</span>
              <span class="chip" onclick="toggleChip(this,'values')" data-v="Ú©Ù…Ú©">ğŸ¤ Ú©Ù…Ú© Ø¨Ù‡ Ø¯ÛŒÚ¯Ø±Ø§Ù†</span>
              <span class="chip" onclick="toggleChip(this,'values')" data-v="Ø§Ø³ØªÙ‚Ù„Ø§Ù„">ğŸ¦… Ø§Ø³ØªÙ‚Ù„Ø§Ù„</span>
            </div>
            <div class="flex gap-2 mb-4">
              <input type="text" id="customValue" placeholder="ÛŒØ§ Ø®ÙˆØ¯Øª Ø¨Ù†ÙˆÛŒØ³..." class="input flex-1">
              <button onclick="addCustomValue()" class="btn btn-secondary">+</button>
            </div>
            <div class="flex gap-3">
              <button onclick="prevStep(1)" class="btn btn-outline flex-1">â†’ Ù‚Ø¨Ù„ÛŒ</button>
              <button onclick="nextStep(3)" class="btn btn-primary flex-1">Ø§Ø¯Ø§Ù…Ù‡ â†</button>
            </div>
          </div>
        </div>
        
        <!-- Step 3: Roles -->
        <div id="step-3" class="step-content hidden">
          <div class="card">
            <div class="card-header">
              <div class="card-icon purple">ğŸ­</div>
              <div>
                <h2 class="card-title">Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ø²Ù†Ø¯Ú¯ÛŒØªØŸ</h2>
                <p class="card-subtitle">Ú©Ø§Ø±Ù‡Ø§ Ø±Ùˆ Ø¨Ù‡ Ø§ÛŒÙ† Ù†Ù‚Ø´â€ŒÙ‡Ø§ ÙˆØµÙ„ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…</p>
              </div>
            </div>
            <div id="rolesChips" class="chips mb-4">
              <span class="chip" onclick="toggleChip(this,'roles')" data-v="Ø¯Ø§Ù†Ø´Ø¬Ùˆ">ğŸ“ Ø¯Ø§Ù†Ø´Ø¬Ùˆ</span>
              <span class="chip" onclick="toggleChip(this,'roles')" data-v="Ø´Ø§ØºÙ„">ğŸ’¼ Ø´Ø§ØºÙ„</span>
              <span class="chip" onclick="toggleChip(this,'roles')" data-v="ÙˆØ§Ù„Ø¯">ğŸ‘¨â€ğŸ‘§ ÙˆØ§Ù„Ø¯</span>
              <span class="chip" onclick="toggleChip(this,'roles')" data-v="Ù‡Ù…Ø³Ø±">ğŸ’‘ Ù‡Ù…Ø³Ø±</span>
              <span class="chip" onclick="toggleChip(this,'roles')" data-v="ÙˆØ±Ø²Ø´Ú©Ø§Ø±">ğŸƒ ÙˆØ±Ø²Ø´Ú©Ø§Ø±</span>
              <span class="chip" onclick="toggleChip(this,'roles')" data-v="Ù‡Ù†Ø±Ù…Ù†Ø¯">ğŸ¨ Ù‡Ù†Ø±Ù…Ù†Ø¯</span>
              <span class="chip" onclick="toggleChip(this,'roles')" data-v="Ú©Ø§Ø±Ø¢ÙØ±ÛŒÙ†">ğŸš€ Ú©Ø§Ø±Ø¢ÙØ±ÛŒÙ†</span>
              <span class="chip" onclick="toggleChip(this,'roles')" data-v="Ø¯ÙˆØ³Øª">ğŸ¤ Ø¯ÙˆØ³Øª</span>
            </div>
            <div class="flex gap-2 mb-4">
              <input type="text" id="customRole" placeholder="ÛŒØ§ Ø®ÙˆØ¯Øª Ø¨Ù†ÙˆÛŒØ³..." class="input flex-1">
              <button onclick="addCustomRole()" class="btn btn-secondary">+</button>
            </div>
            <div class="flex gap-3">
              <button onclick="prevStep(2)" class="btn btn-outline flex-1">â†’ Ù‚Ø¨Ù„ÛŒ</button>
              <button onclick="nextStep(4)" class="btn btn-primary flex-1">Ø§Ø¯Ø§Ù…Ù‡ â†</button>
            </div>
          </div>
        </div>
        
        <!-- Step 4: Energy -->
        <div id="step-4" class="step-content hidden">
          <div class="card">
            <div class="card-header">
              <div class="card-icon yellow">âš¡</div>
              <div>
                <h2 class="card-title">Ú©ÛŒ Ø§Ù†Ø±Ú˜ÛŒâ€ŒØ§Øª Ø¨ÛŒØ´ØªØ±Ù‡ØŸ</h2>
                <p class="card-subtitle">Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø³Ø®Øª Ø±Ùˆ Ø§ÙˆÙ† Ù…ÙˆÙ‚Ø¹ Ø¨Ø°Ø§Ø±</p>
              </div>
            </div>
            <div class="time-blocks mb-4">
              <div class="time-block" onclick="selectEnergy('morning',this)">
                <div class="time-block-icon">ğŸŒ…</div>
                <div class="time-block-label">ØµØ¨Ø­</div>
              </div>
              <div class="time-block" onclick="selectEnergy('afternoon',this)">
                <div class="time-block-icon">â˜€ï¸</div>
                <div class="time-block-label">Ø¨Ø¹Ø¯Ø§Ø²Ø¸Ù‡Ø±</div>
              </div>
              <div class="time-block" onclick="selectEnergy('evening',this)">
                <div class="time-block-icon">ğŸŒ™</div>
                <div class="time-block-label">Ø´Ø¨</div>
              </div>
            </div>
            <div class="flex gap-3">
              <button onclick="prevStep(3)" class="btn btn-outline flex-1">â†’ Ù‚Ø¨Ù„ÛŒ</button>
              <button onclick="nextStep(5)" class="btn btn-primary flex-1">Ø§Ø¯Ø§Ù…Ù‡ â†</button>
            </div>
          </div>
        </div>
        
        <!-- Step 5: Identity -->
        <div id="step-5" class="step-content hidden">
          <div class="card">
            <div class="card-header">
              <div class="card-icon green">ğŸŒ±</div>
              <div>
                <h2 class="card-title">Ø¬Ù…Ù„Ù‡ Ù‡ÙˆÛŒØªÛŒ ØªÙˆ</h2>
                <p class="card-subtitle">Ø§ÛŒÙ† Ø¬Ù…Ù„Ù‡ ÛŒØ§Ø¯Ø¢ÙˆØ± Ù…Ø³ÛŒØ±ØªÙ‡</p>
              </div>
            </div>
            <div class="result-box mb-4">
              <p class="text-sm" id="identityPreview">
                Â«Ù…Ù† <strong id="pvName">Ø¯ÙˆØ³Øª</strong> Ù‡Ø³ØªÙ… Ú©Ù‡ Ø¨Ø±Ø§Ù… <strong id="pvValues">ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ</strong> Ù…Ù‡Ù…Ù‡ Ùˆ Ø¯Ø± Ù†Ù‚Ø´ <strong id="pvRoles">Ø¯Ø§Ù†Ø´Ø¬Ùˆ</strong> Ù‚Ø¯Ù…â€ŒØ¨Ù‡â€ŒÙ‚Ø¯Ù… Ù¾ÛŒØ´ Ù…ÛŒâ€ŒØ±Ù….Â»
              </p>
            </div>
            <textarea id="identityText" rows="2" class="textarea mb-4" placeholder="Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´Ø´ Ú©Ù†ÛŒ..."></textarea>
            <div class="flex gap-3">
              <button onclick="prevStep(4)" class="btn btn-outline flex-1">â†’ Ù‚Ø¨Ù„ÛŒ</button>
              <button onclick="completeOnboarding()" class="btn btn-primary flex-1">Ø´Ø±ÙˆØ¹! ğŸ‰</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Today Page -->
      <div id="page-today" class="page">
        <div class="banner">
          <div class="flex justify-between items-center">
            <div>
              <h1 class="banner-title">Ø³Ù„Ø§Ù… <span id="greetName">Ø¯ÙˆØ³Øª</span> ğŸ‘‹</h1>
              <p class="banner-subtitle" id="todayDate"></p>
            </div>
            <div class="banner-streak">
              <div class="banner-streak-number" id="streakNum">Û° ğŸ”¥</div>
              <div class="banner-streak-label">Ø±ÙˆØ² Ù…ØªÙˆØ§Ù„ÛŒ</div>
            </div>
          </div>
        </div>
        
        <!-- Flow -->
        <div class="flow-container">
          <div class="flow-steps">
            <div class="flow-step active" onclick="scrollToSection('dump')">
              <div class="flow-step-icon">ğŸ§ </div>
              <div class="flow-step-label">ØªØ®Ù„ÛŒÙ‡</div>
            </div>
            <div class="flow-step" onclick="scrollToSection('plan')">
              <div class="flow-step-icon">ğŸ“</div>
              <div class="flow-step-label">Ø¨Ø±Ù†Ø§Ù…Ù‡</div>
            </div>
            <div class="flow-step" onclick="scrollToSection('plan')">
              <div class="flow-step-icon">âš¡</div>
              <div class="flow-step-label">Ø§Ù†Ø¬Ø§Ù…</div>
            </div>
            <div class="flow-step" onclick="scrollToSection('review')">
              <div class="flow-step-icon">ğŸ“Š</div>
              <div class="flow-step-label">Ù…Ø±ÙˆØ±</div>
            </div>
          </div>
        </div>
        
        <!-- Stats -->
        <div class="stats-grid mb-4">
          <div class="stat-box">
            <div class="stat-number" id="statDone">Û°</div>
            <div class="stat-label">Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡</div>
          </div>
          <div class="stat-box">
            <div class="stat-number" id="statTotal">Û°</div>
            <div class="stat-label">Ú©Ù„ Ø§Ù…Ø±ÙˆØ²</div>
          </div>
          <div class="stat-box">
            <div class="stat-number" id="statDays">Û°</div>
            <div class="stat-label">Ø±ÙˆØ² ÙØ¹Ø§Ù„</div>
          </div>
          <div class="stat-box">
            <div class="stat-number" id="statWeek">Û°Ùª</div>
            <div class="stat-label">Ø§ÛŒÙ† Ù‡ÙØªÙ‡</div>
          </div>
        </div>
        
        <!-- Brain Dump -->
        <div id="sec-dump" class="card">
          <div class="card-header">
            <div class="card-icon blue">ğŸ§ </div>
            <div>
              <h2 class="card-title">ØªØ®Ù„ÛŒÙ‡ Ø°Ù‡Ù†</h2>
              <p class="card-subtitle">Ù‡Ø± Ú†ÛŒ ØªÙˆÛŒ Ø°Ù‡Ù†ØªÙ‡ Ø¨Ø±ÛŒØ² Ø¨ÛŒØ±ÙˆÙ†</p>
            </div>
          </div>
          <div id="brainList" class="mb-3"></div>
          <div class="flex gap-2">
            <input type="text" id="brainInput" placeholder="ÛŒÙ‡ ÙÚ©Ø±ØŒ Ù†Ú¯Ø±Ø§Ù†ÛŒØŒ Ú©Ø§Ø±..." class="input flex-1" onkeypress="if(event.key==='Enter')addBrain()">
            <button onclick="addBrain()" class="btn btn-secondary">+</button>
          </div>
          <p class="text-xs text-tertiary mt-3">ğŸ’¡ Ø¨Ø§ ğŸ¯ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ú©Ø§Ø± Ú©Ù†</p>
        </div>
        
        <!-- Tasks -->
        <div id="sec-plan" class="card">
          <div class="card-header">
            <div class="card-icon green">ğŸ¯</div>
            <div>
              <h2 class="card-title">Û± ØªØ§ Û³ Ú©Ø§Ø± Ù…Ù‡Ù… Ø§Ù…Ø±ÙˆØ²</h2>
              <p class="card-subtitle">ÙÙ‚Ø· Ù…Ù‡Ù…â€ŒØªØ±ÛŒÙ†â€ŒÙ‡Ø§</p>
            </div>
          </div>
          
          <!-- Progress -->
          <div class="mb-4">
            <div class="flex justify-between text-xs mb-2">
              <span class="text-secondary">Ù¾ÛŒØ´Ø±ÙØª</span>
              <span style="color: var(--primary-600); font-weight: 600;" id="progPercent">Û°Ùª</span>
            </div>
            <div class="progress">
              <div id="progFill" class="progress-bar" style="width:0%"></div>
            </div>
          </div>
          
          <div id="tasksList" class="mb-4"></div>
          
          <!-- Add Task Form -->
          <div style="background: var(--bg-secondary); border-radius: var(--radius-lg); padding: 16px;">
            <input type="text" id="taskTitle" placeholder="Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ø§Ù…Ø±ÙˆØ² Ù…Ù‡Ù…Ù‡ØŸ" class="input mb-3">
            <div class="grid grid-cols-3 gap-2 mb-3">
              <select id="taskRole" class="select text-sm"><option value="">Ù†Ù‚Ø´</option></select>
              <select id="taskTime" class="select text-sm">
                <option value="15">Û±Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡</option>
                <option value="30" selected>Û³Û° Ø¯Ù‚ÛŒÙ‚Ù‡</option>
                <option value="60">Û± Ø³Ø§Ø¹Øª</option>
                <option value="120">Û² Ø³Ø§Ø¹Øª</option>
              </select>
              <select id="taskBlock" class="select text-sm">
                <option value="morning">ğŸŒ… ØµØ¨Ø­</option>
                <option value="afternoon">â˜€ï¸ Ø¸Ù‡Ø±</option>
                <option value="evening">ğŸŒ™ Ø´Ø¨</option>
              </select>
            </div>
            <button onclick="addTask()" class="btn btn-primary btn-block" id="addTaskBtn">+ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±</button>
            <p id="taskLimit" class="text-xs text-center mt-3 hidden" style="color: var(--warning);">âš ï¸ Ø§Ø² Û³ Ú©Ø§Ø± Ø¨ÛŒØ´ØªØ± Ù†Ø¨Ø§Ø´Ù‡</p>
          </div>
        </div>
        
        <!-- Review -->
        <div id="sec-review" class="card">
          <div class="card-header">
            <div class="card-icon purple">ğŸ“</div>
            <div>
              <h2 class="card-title">Ù…Ø±ÙˆØ± Ø§Ù…Ø±ÙˆØ²</h2>
              <p class="card-subtitle">Ú†Ù†Ø¯ Ø«Ø§Ù†ÛŒÙ‡ ÙÚ©Ø± Ú©Ù†</p>
            </div>
          </div>
          <div class="input-group">
            <label class="input-label">âœ… Ú†ÛŒ Ø®ÙˆØ¨ Ù¾ÛŒØ´ Ø±ÙØªØŸ</label>
            <textarea id="revGood" rows="2" class="textarea" placeholder="Ø­ØªÛŒ Ú†ÛŒØ²Ø§ÛŒ Ú©ÙˆÚ†ÛŒÚ©..."></textarea>
          </div>
          <div class="input-group">
            <label class="input-label">ğŸ¤” Ú†ÛŒ Ù…ÛŒâ€ŒØªÙˆÙ†Ø³Øª Ø¨Ù‡ØªØ± Ø¨Ø§Ø´Ù‡ØŸ</label>
            <textarea id="revBetter" rows="2" class="textarea" placeholder="Ø¨Ø¯ÙˆÙ† Ø³Ø±Ø²Ù†Ø´..."></textarea>
          </div>
          <div class="input-group">
            <label class="input-label">ğŸ’¡ ÙØ±Ø¯Ø§ ÛŒÙ‡ ØªØºÛŒÛŒØ± Ú©ÙˆÚ†Ú©:</label>
            <input type="text" id="revTomorrow" class="input" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø²ÙˆØ¯ØªØ± Ø´Ø±ÙˆØ¹ Ú©Ù†Ù…...">
          </div>
          <button onclick="saveReview()" class="btn btn-primary btn-block">Ø°Ø®ÛŒØ±Ù‡ âœ“</button>
        </div>
        
        <div class="result-box text-center">
          <p class="text-sm">ğŸ’š Ø­ØªÛŒ Ø§Ú¯Ù‡ ÛŒÙ‡ Ú©Ø§Ø± Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ØŒ Ø±ÙˆØ² Ù…ÙˆÙÙ‚ÛŒ Ø¨ÙˆØ¯Ù‡!</p>
        </div>
      </div>
      
      <!-- Week Page -->
      <div id="page-week" class="page">
        <div class="card">
          <div class="card-header">
            <div class="card-icon blue">ğŸ“Š</div>
            <div>
              <h2 class="card-title">Ø¢Ù…Ø§Ø± Ø§ÛŒÙ† Ù‡ÙØªÙ‡</h2>
            </div>
          </div>
          <div class="stats-grid mb-4">
            <div class="stat-box">
              <div class="stat-number" id="wkDone">Û°</div>
              <div class="stat-label">Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡</div>
            </div>
            <div class="stat-box">
              <div class="stat-number" id="wkPlan">Û°</div>
              <div class="stat-label">Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ</div>
            </div>
            <div class="stat-box">
              <div class="stat-number" id="wkDays">Û°</div>
              <div class="stat-label">Ø±ÙˆØ² ÙØ¹Ø§Ù„</div>
            </div>
            <div class="stat-box">
              <div class="stat-number" id="wkPercent">Û°Ùª</div>
              <div class="stat-label">Ù…ÙˆÙÙ‚ÛŒØª</div>
            </div>
          </div>
          <div class="input-group">
            <label class="input-label">ØªÙˆØ²ÛŒØ¹ Ù†Ù‚Ø´â€ŒÙ‡Ø§:</label>
            <div id="rolesDist" class="chips"></div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <div class="card-icon yellow">ğŸ”</div>
            <div>
              <h2 class="card-title">Ù…Ø±ÙˆØ± Ù‡ÙØªÚ¯ÛŒ</h2>
            </div>
          </div>
          <div class="input-group">
            <label class="input-label">ğŸ† Ú©Ø¬Ø§Ù‡Ø§ Ù¾ÛŒØ´Ø±ÙØª Ú©Ø±Ø¯ÛŒØŸ</label>
            <textarea id="wkHighlight" rows="2" class="textarea"></textarea>
          </div>
          <div class="input-group">
            <label class="input-label">ğŸš§ Ù…ÙˆØ§Ù†Ø¹ Ø±Ø§ÛŒØ¬:</label>
            <div id="obstacleChips" class="chips">
              <span class="chip" onclick="toggleChip(this,'obstacles')" data-v="Ø®Ø³ØªÚ¯ÛŒ">ğŸ˜´ Ø®Ø³ØªÚ¯ÛŒ</span>
              <span class="chip" onclick="toggleChip(this,'obstacles')" data-v="Ø­ÙˆØ§Ø³â€ŒÙ¾Ø±ØªÛŒ">ğŸ“± Ø­ÙˆØ§Ø³â€ŒÙ¾Ø±ØªÛŒ</span>
              <span class="chip" onclick="toggleChip(this,'obstacles')" data-v="Ú©Ù…Ø§Ù„â€ŒÚ¯Ø±Ø§ÛŒÛŒ">ğŸ˜° Ú©Ù…Ø§Ù„â€ŒÚ¯Ø±Ø§ÛŒÛŒ</span>
              <span class="chip" onclick="toggleChip(this,'obstacles')" data-v="Ø²ÛŒØ§Ø¯ÛŒ Ú©Ø§Ø±">ğŸ“‹ Ø²ÛŒØ§Ø¯ÛŒ Ú©Ø§Ø±</span>
            </div>
          </div>
          <div class="input-group">
            <label class="input-label">ğŸ§ª Ø¢Ø²Ù…Ø§ÛŒØ´ Ù‡ÙØªÙ‡ Ø¨Ø¹Ø¯:</label>
            <input type="text" id="wkExperiment" class="input" placeholder="ÛŒÙ‡ ØªØºÛŒÛŒØ± Ú©ÙˆÚ†Ú©...">
          </div>
          <button onclick="saveWeekReview()" class="btn btn-primary btn-block">Ø°Ø®ÛŒØ±Ù‡ âœ“</button>
        </div>
        
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background: var(--gray-100);">ğŸ“œ</div>
            <div>
              <h2 class="card-title">ØªØ§Ø±ÛŒØ®Ú†Ù‡</h2>
            </div>
          </div>
          <div id="reviewHistory"></div>
        </div>
      </div>
      
      <!-- Habits Page -->
      <div id="page-habits" class="page">
        <div class="card">
          <div class="card-header">
            <div class="card-icon green">ğŸ”—</div>
            <div>
              <h2 class="card-title">Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú©</h2>
              <p class="card-subtitle">Ø¨Ø¹Ø¯ Ø§Ø² XØŒ ÙÙ‚Ø· Y Ù…ÛŒâ€ŒÚ©Ù†Ù…</p>
            </div>
          </div>
          <div id="habitsList" class="mb-4"></div>
          <div style="background: var(--bg-secondary); border-radius: var(--radius-lg); padding: 16px;">
            <div class="input-group">
              <label class="input-label">Ø¨Ø¹Ø¯ Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡...</label>
              <input type="text" id="habitAnchor" class="input" placeholder="ØµØ¨Ø­Ø§Ù†Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ±Ù…">
            </div>
            <div class="input-group">
              <label class="input-label">ÙÙ‚Ø·...</label>
              <input type="text" id="habitBehavior" class="input" placeholder="Û² Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³Ù…">
            </div>
            <button onclick="addHabit()" class="btn btn-primary btn-block">+ Ø§ÙØ²ÙˆØ¯Ù†</button>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <div class="card-icon purple">âš¡</div>
            <div>
              <h2 class="card-title">Ø§Ú¯Ø±... Ø¢Ù†Ú¯Ø§Ù‡...</h2>
              <p class="card-subtitle">Ø§Ø² Ù‚Ø¨Ù„ ØªØµÙ…ÛŒÙ… Ø¨Ú¯ÛŒØ±</p>
            </div>
          </div>
          <div id="ifThenList" class="mb-4"></div>
          <div style="background: var(--bg-secondary); border-radius: var(--radius-lg); padding: 16px;">
            <div class="input-group">
              <label class="input-label">Ø§Ú¯Ø±...</label>
              <input type="text" id="ifCond" class="input" placeholder="Ø­ÙˆØµÙ„Ù‡â€ŒØ§Ù… Ù†Ø¨ÙˆØ¯">
            </div>
            <div class="input-group">
              <label class="input-label">Ø¢Ù†Ú¯Ø§Ù‡...</label>
              <input type="text" id="thenAct" class="input" placeholder="ÙÙ‚Ø· Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒÚ©Ù†Ù…">
            </div>
            <button onclick="addIfThen()" class="btn btn-secondary btn-block">+ Ø§ÙØ²ÙˆØ¯Ù†</button>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <div class="card-icon yellow">â­</div>
            <div>
              <h2 class="card-title">WOOP</h2>
              <p class="card-subtitle">Ø¢Ø±Ø²Ùˆ â†’ Ù†ØªÛŒØ¬Ù‡ â†’ Ù…Ø§Ù†Ø¹ â†’ Ø¨Ø±Ù†Ø§Ù…Ù‡</p>
            </div>
          </div>
          <div id="woopList" class="mb-4"></div>
          <div style="background: var(--bg-secondary); border-radius: var(--radius-lg); padding: 16px;">
            <div class="grid grid-cols-2 gap-3 mb-3">
              <div class="input-group mb-0">
                <label class="input-label text-xs">ğŸŒŸ Ø¢Ø±Ø²Ùˆ</label>
                <input type="text" id="woopW" class="input text-sm" placeholder="Ù‡Ø¯ÙØª?">
              </div>
              <div class="input-group mb-0">
                <label class="input-label text-xs">âœ¨ Ù†ØªÛŒØ¬Ù‡</label>
                <input type="text" id="woopO" class="input text-sm" placeholder="Ú†Ù‡ Ø­Ø³ÛŒ?">
              </div>
            </div>
            <div class="grid grid-cols-2 gap-3 mb-3">
              <div class="input-group mb-0">
                <label class="input-label text-xs">ğŸš§ Ù…Ø§Ù†Ø¹</label>
                <input type="text" id="woopOb" class="input text-sm" placeholder="Ú†ÛŒ Ø¬Ù„ÙˆØªÙ‡?">
              </div>
              <div class="input-group mb-0">
                <label class="input-label text-xs">ğŸ“‹ Ø¨Ø±Ù†Ø§Ù…Ù‡</label>
                <input type="text" id="woopP" class="input text-sm" placeholder="Ø§Ú¯Ù‡ Ù…Ø§Ù†Ø¹ Ø§ÙˆÙ…Ø¯?">
              </div>
            </div>
            <button onclick="addWoop()" class="btn btn-primary btn-block">+ Ø§ÙØ²ÙˆØ¯Ù†</button>
          </div>
        </div>
      </div>
      
      <!-- Learn Page -->
      <div id="page-learn" class="page">
        <div class="card">
          <div class="card-header">
            <div class="card-icon blue">ğŸ“š</div>
            <div>
              <h2 class="card-title">Ø§ØµÙˆÙ„ Ø¹Ù„Ù…ÛŒ</h2>
            </div>
          </div>
        </div>
        
        <div class="accordion" onclick="this.classList.toggle('open')">
          <div class="accordion-header">
            <span>ğŸ¯ ÙÙ‚Ø· Û±-Û³ Ú©Ø§Ø± Ù…Ù‡Ù…</span>
            <span class="accordion-icon">â–¼</span>
          </div>
          <div class="accordion-body">Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Û³ Ú©Ø§Ø± Ø¨Ø§Ø¹Ø« Ù…ÛŒØ´Ù‡ Ø°Ù‡Ù†Øª Ù‚ÙÙ„ Ù†Ú©Ù†Ù‡ Ùˆ ØªÙ…Ø±Ú©Ø² Ø¨ÛŒØ´ØªØ±ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒ.</div>
        </div>
        
        <div class="accordion" onclick="this.classList.toggle('open')">
          <div class="accordion-header">
            <span>â° Ø®Ø·Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ</span>
            <span class="accordion-icon">â–¼</span>
          </div>
          <div class="accordion-body">Ù‡Ù…Ù‡ ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ú©Ø§Ø±Ù‡Ø§ Ø³Ø±ÛŒØ¹â€ŒØªØ± ØªÙ…ÙˆÙ… Ù…ÛŒØ´Ù‡. Ø¶Ø±ÛŒØ¨ Û±.Ûµ Ø§ÛŒÙ† Ø®Ø·Ø§ Ø±Ùˆ Ø¬Ø¨Ø±Ø§Ù† Ù…ÛŒâ€ŒÚ©Ù†Ù‡.</div>
        </div>
        
        <div class="accordion" onclick="this.classList.toggle('open')">
          <div class="accordion-header">
            <span>ğŸ§  ØªØ®Ù„ÛŒÙ‡ Ø°Ù‡Ù†</span>
            <span class="accordion-icon">â–¼</span>
          </div>
          <div class="accordion-body">ÙˆÙ‚ØªÛŒ ÙÚ©Ø±Ù‡Ø§ Ø±Ùˆ Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³ÛŒØŒ Ø°Ù‡Ù†Øª Ø¢Ø²Ø§Ø¯ Ù…ÛŒØ´Ù‡ Ùˆ Ø§Ø¶Ø·Ø±Ø§Ø¨ Ú©Ù… Ù…ÛŒØ´Ù‡ (Ø§Ø«Ø± Zeigarnik).</div>
        </div>
        
        <div class="accordion" onclick="this.classList.toggle('open')">
          <div class="accordion-header">
            <span>ğŸ”— Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú©</span>
            <span class="accordion-icon">â–¼</span>
          </div>
          <div class="accordion-body">Ø¹Ø§Ø¯Øª Ø¬Ø¯ÛŒØ¯ Ø±Ùˆ Ø¨Ù‡ ÛŒÙ‡ Ú©Ø§Ø± Ù‚Ø¨Ù„ÛŒ ÙˆØµÙ„ Ú©Ù† ØªØ§ Ø®ÙˆØ¯Ú©Ø§Ø± ÛŒØ§Ø¯Øª Ø¨ÛŒØ§Ø¯ (Ø±ÙˆØ´ BJ Fogg).</div>
        </div>
        
        <div class="accordion" onclick="this.classList.toggle('open')">
          <div class="accordion-header">
            <span>âš¡ Ø§Ú¯Ø±... Ø¢Ù†Ú¯Ø§Ù‡...</span>
            <span class="accordion-icon">â–¼</span>
          </div>
          <div class="accordion-body">Ø§Ø² Ù‚Ø¨Ù„ ØªØµÙ…ÛŒÙ… Ø¨Ú¯ÛŒØ± ØªØ§ Ù…ÙˆÙ‚Ø¹ Ø±ÙˆÛŒØ§Ø±ÙˆÛŒÛŒ Ø³Ø±ÛŒØ¹â€ŒØªØ± Ø¹Ù…Ù„ Ú©Ù†ÛŒ (Implementation Intentions).</div>
        </div>
        
        <div class="accordion" onclick="this.classList.toggle('open')">
          <div class="accordion-header">
            <span>ğŸ’š Ø®ÙˆØ¯Ø´ÙÙ‚ØªÛŒ</span>
            <span class="accordion-icon">â–¼</span>
          </div>
          <div class="accordion-body">Ù…Ù‡Ø±Ø¨ÙˆÙ† Ø¨ÙˆØ¯Ù† Ø¨Ø§ Ø®ÙˆØ¯Øª Ø¨Ø§Ø¹Ø« Ù…ÛŒØ´Ù‡ Ø¯ÙØ¹Ù‡ Ø¨Ø¹Ø¯ Ø¨ÛŒØ´ØªØ± ØªÙ„Ø§Ø´ Ú©Ù†ÛŒ. Ø³Ø±Ø²Ù†Ø´ ÙÙ‚Ø· Ø¨Ø¯ØªØ± Ù…ÛŒâ€ŒÚ©Ù†Ù‡.</div>
        </div>
        
        <div class="accordion" onclick="this.classList.toggle('open')">
          <div class="accordion-header">
            <span>ğŸ­ Ù‡ÙˆÛŒØª Ùˆ Ø§Ø±Ø²Ø´â€ŒÙ‡Ø§</span>
            <span class="accordion-icon">â–¼</span>
          </div>
          <div class="accordion-body">ÙˆÙ‚ØªÛŒ Ú©Ø§Ø±Ù‡Ø§Øª Ø¨Ù‡ Ø§Ø±Ø²Ø´â€ŒÙ‡Ø§Øª ÙˆØµÙ„ Ø¨Ø§Ø´Ù†ØŒ Ø§Ù†Ú¯ÛŒØ²Ù‡â€ŒØ§Øª Ø¯Ø±ÙˆÙ†ÛŒâ€ŒØªØ±Ù‡ Ùˆ Ù¾Ø§ÛŒØ¯Ø§Ø±ØªØ± Ù…ÛŒâ€ŒÙ…ÙˆÙ†ÛŒ.</div>
        </div>
        
        <div class="accordion" onclick="this.classList.toggle('open')">
          <div class="accordion-header">
            <span>â­ WOOP</span>
            <span class="accordion-icon">â–¼</span>
          </div>
          <div class="accordion-body">Ø¢Ø±Ø²ÙˆØŒ Ù†ØªÛŒØ¬Ù‡ØŒ Ù…Ø§Ù†Ø¹ØŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ - ÙˆØ§Ù‚Ø¹â€ŒØ¨ÛŒÙ†Ø§Ù†Ù‡â€ŒØªØ± Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø±ÛŒØ² Ùˆ Ù…ÙˆØ§Ù†Ø¹ Ø±Ùˆ Ø§Ø² Ù‚Ø¨Ù„ Ø¨Ø¨ÛŒÙ†.</div>
        </div>
      </div>
      
      <!-- AI Page -->
      <div id="page-ai" class="page">
        <div class="ai-box mb-4">
          <div class="ai-icon">ğŸ¤–</div>
          <h2 class="text-lg font-bold mb-2">ØªØ­Ù„ÛŒÙ„ Ø¨Ø§ AI</h2>
          <p class="text-sm text-secondary mb-4">Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§Øª Ø±Ùˆ Ù¾Ú© Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…ØŒ Ø¨ÙØ±Ø³Øª Ø¨Ù‡ ChatGPT</p>
          <button onclick="generatePrompt()" class="btn btn-primary btn-lg" style="background: linear-gradient(135deg, #8B5CF6, #EC4899);">
            âœ¨ Ø³Ø§Ø®ØªÙ† Ù¾Ø±Ø§Ù…Ù¾Øª
          </button>
        </div>
        
        <div id="promptContainer" class="hidden">
          <div class="card">
            <div class="card-header">
              <div class="card-icon purple">ğŸ“‹</div>
              <div>
                <h2 class="card-title">Ù¾Ø±Ø§Ù…Ù¾Øª Ø¢Ù…Ø§Ø¯Ù‡</h2>
                <p class="card-subtitle">Ú©Ù¾ÛŒ Ú©Ù† Ùˆ Ø¨ÙØ±Ø³Øª</p>
              </div>
            </div>
            <div class="prompt-box" id="promptText"></div>
            <div class="flex gap-3 mt-4">
              <button onclick="copyPrompt()" class="btn btn-primary flex-1">ğŸ“‹ Ú©Ù¾ÛŒ</button>
              <a href="https://chat.openai.com" target="_blank" class="btn btn-secondary flex-1 text-center">ğŸ”— ChatGPT</a>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Settings Page -->
      <div id="page-settings" class="page">
        <div class="card" style="border: 2px solid var(--warning);">
          <div class="card-header">
            <div class="card-icon yellow">ğŸ’¾</div>
            <div>
              <h2 class="card-title">Ø¨Ú©Ø§Ù¾ (Ù…Ù‡Ù…!)</h2>
              <p class="card-subtitle">Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†</p>
            </div>
          </div>
          <div class="backup-box">
            <div class="font-semibold text-sm">ğŸ“ ÙØ§ÛŒÙ„ Ø¯Ø± Ù¾ÙˆØ´Ù‡ Downloads Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒØ´Ù‡</div>
            <code>aram-planner-backup.json</code>
          </div>
          <button onclick="downloadBackup()" class="btn btn-success btn-block mb-3">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ú©Ø§Ù¾</button>
          <button onclick="copyBackup()" class="btn btn-warning btn-block mb-3">ğŸ“‹ Ú©Ù¾ÛŒ Ù…ØªÙ†</button>
          <label class="btn btn-outline btn-block mb-3">
            ğŸ“¤ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² ÙØ§ÛŒÙ„
            <input type="file" id="importSettings" accept=".json" style="display:none">
          </label>
          <div class="input-group">
            <label class="input-label">ÛŒØ§ Ù…ØªÙ† Ø¨Ú©Ø§Ù¾ Ø±Ùˆ Paste Ú©Ù†:</label>
            <textarea id="pasteBackup" rows="2" class="textarea text-xs" style="direction:ltr" placeholder='{"user":...}'></textarea>
          </div>
          <button onclick="importPaste()" class="btn btn-outline btn-block">ğŸ“¥ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ù…ØªÙ†</button>
        </div>
        
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background: var(--gray-100);">âš™ï¸</div>
            <div>
              <h2 class="card-title">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
            </div>
          </div>
          <div class="theme-toggle mb-4" onclick="toggleTheme()">
            <span style="font-size: 1.25rem;">ğŸŒ™</span>
            <span class="flex-1">Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©</span>
            <div class="toggle-switch" id="themeToggle"></div>
          </div>
          <div class="input-group">
            <label class="input-label">Ø§Ø³Ù…:</label>
            <input type="text" id="setName" class="input">
          </div>
          <div class="input-group">
            <label class="input-label">Ø­Ø¯Ø§Ú©Ø«Ø± Ú©Ø§Ø± Ø±ÙˆØ²Ø§Ù†Ù‡:</label>
            <select id="setMax" class="select">
              <option value="1">Û±</option>
              <option value="2">Û²</option>
              <option value="3" selected>Û³</option>
            </select>
          </div>
          <button onclick="saveSettings()" class="btn btn-primary btn-block">Ø°Ø®ÛŒØ±Ù‡ âœ“</button>
        </div>
        
        <div class="card">
          <div class="card-header">
            <div class="card-icon purple">ğŸ’</div>
            <div>
              <h2 class="card-title">Ø§Ø±Ø²Ø´â€ŒÙ‡Ø§ Ùˆ Ù†Ù‚Ø´â€ŒÙ‡Ø§</h2>
            </div>
          </div>
          <div class="input-group">
            <label class="input-label">Ø§Ø±Ø²Ø´â€ŒÙ‡Ø§:</label>
            <div id="setValues" class="text-secondary text-sm"></div>
          </div>
          <div class="input-group">
            <label class="input-label">Ù†Ù‚Ø´â€ŒÙ‡Ø§:</label>
            <div id="setRoles" class="text-secondary text-sm"></div>
          </div>
          <div class="input-group">
            <label class="input-label">Ø¬Ù…Ù„Ù‡ Ù‡ÙˆÛŒØªÛŒ:</label>
            <textarea id="setIdentity" rows="2" class="textarea"></textarea>
          </div>
          <button onclick="saveIdentity()" class="btn btn-secondary btn-block">Ø°Ø®ÛŒØ±Ù‡</button>
        </div>
        
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background: #FEE2E2;">ğŸ—‘ï¸</div>
            <div>
              <h2 class="card-title">Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡</h2>
            </div>
          </div>
          <button onclick="resetOnboarding()" class="btn btn-outline btn-block mb-3">ğŸ”„ Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
          <button onclick="clearAll()" class="btn btn-danger btn-block">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡</button>
        </div>
      </div>
      
    </main>
    
    <!-- Bottom Navigation -->
    <nav class="bottom-nav" id="bottomNav" style="display:none">
      <div class="nav-item active" onclick="goTo('today',this)">
        <div class="nav-icon">ğŸ“</div>
        <div class="nav-label">Ø§Ù…Ø±ÙˆØ²</div>
      </div>
      <div class="nav-item" onclick="goTo('week',this)">
        <div class="nav-icon">ğŸ“Š</div>
        <div class="nav-label">Ù‡ÙØªÙ‡</div>
      </div>
      <div class="nav-item" onclick="goTo('habits',this)">
        <div class="nav-icon">ğŸ”—</div>
        <div class="nav-label">Ø¹Ø§Ø¯Øª</div>
      </div>
      <div class="nav-item" onclick="goTo('learn',this)">
        <div class="nav-icon">ğŸ“š</div>
        <div class="nav-label">ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ</div>
      </div>
      <div class="nav-item" onclick="goTo('ai',this)">
        <div class="nav-icon">ğŸ¤–</div>
        <div class="nav-label">AI</div>
      </div>
      <div class="nav-item" onclick="goTo('settings',this)">
        <div class="nav-icon">âš™ï¸</div>
        <div class="nav-label">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</div>
      </div>
    </nav>
    
  </div>

<script>
// ==================== STATE ====================
const STORAGE_KEY = 'aram_planner_v6';

let state = {
  user: {
    name: '',
    values: [],
    roles: [],
    energy: 'morning',
    maxTasks: 3,
    identity: ''
  },
  tasks: [],
  brainDump: [],
  habits: [],
  ifThens: [],
  woops: [],
  reviews: [],
  weeklyReviews: [],
  streak: 0,
  totalDays: 0,
  activeDates: [],
  lastActive: null,
  onboardingDone: false,
  theme: 'light'
};

let temp = { values: [], roles: [], obstacles: [] };
let deferredPrompt = null;

// ==================== STORAGE ====================
function saveToStorage() {
  try {
    const data = JSON.stringify(state);
    localStorage.setItem(STORAGE_KEY, data);
    
    // Also save to IndexedDB for more reliability
    if ('indexedDB' in window) {
      const req = indexedDB.open('AramPlannerDB', 1);
      req.onupgradeneeded = (e) => {
        e.target.result.createObjectStore('data');
      };
      req.onsuccess = (e) => {
        const db = e.target.result;
        const tx = db.transaction('data', 'readwrite');
        tx.objectStore('data').put(data, 'state');
      };
    }
    
    console.log('âœ… Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
  } catch (e) {
    console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡:', e);
  }
}

function loadFromStorage() {
  try {
    const data = localStorage.getItem(STORAGE_KEY);
    if (data) {
      const parsed = JSON.parse(data);
      state = { ...state, ...parsed };
      if (parsed.user) state.user = { ...state.user, ...parsed.user };
      return true;
    }
  } catch (e) {
    console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ:', e);
  }
  return false;
}

// ==================== BACKUP ====================
function downloadBackup() {
  try {
    const data = JSON.stringify(state, null, 2);
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = 'aram-planner-backup.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    toast('âœ… ÙØ§ÛŒÙ„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯ - Ù¾ÙˆØ´Ù‡ Downloads');
  } catch (e) {
    console.error(e);
    copyBackup();
  }
}

function copyBackup() {
  const data = JSON.stringify(state);
  navigator.clipboard.writeText(data).then(() => {
    toast('ğŸ“‹ Ú©Ù¾ÛŒ Ø´Ø¯ - Ø¯Ø± Notes Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†');
  }).catch(() => {
    prompt('Ù…ØªÙ† Ø²ÛŒØ± Ø±Ùˆ Ú©Ù¾ÛŒ Ú©Ù†:', data);
  });
}

function importFromFile(file) {
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const data = JSON.parse(e.target.result);
      if (data.user) {
        state = { ...state, ...data };
        if (data.user) state.user = { ...state.user, ...data.user };
        saveToStorage();
        toast('âœ… Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯!');
        setTimeout(() => location.reload(), 1000);
      } else {
        throw new Error('Invalid');
      }
    } catch (e) {
      toast('âŒ ÙØ§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
    }
  };
  reader.readAsText(file);
}

function importPaste() {
  const text = document.getElementById('pasteBackup').value.trim();
  if (!text) {
    toast('âŒ Ù…ØªÙ†ÛŒ Ù†ÛŒØ³Øª');
    return;
  }
  try {
    const data = JSON.parse(text);
    if (data.user) {
      state = { ...state, ...data };
      if (data.user) state.user = { ...state.user, ...data.user };
      saveToStorage();
      toast('âœ… Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯!');
      setTimeout(() => location.reload(), 1000);
    } else {
      throw new Error('Invalid');
    }
  } catch (e) {
    toast('âŒ Ù…ØªÙ† Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
  }
}

// ==================== UI HELPERS ====================
function toast(msg) {
  const t = document.createElement('div');
  t.style.cssText = 'position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:var(--text-primary);color:var(--bg-primary);padding:12px 24px;border-radius:12px;font-size:14px;font-weight:600;z-index:9999;box-shadow:0 4px 20px rgba(0,0,0,0.2)';
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => {
    t.style.opacity = '0';
    t.style.transition = 'opacity 0.3s';
    setTimeout(() => t.remove(), 300);
  }, 2500);
}

function toPersian(num) {
  return num.toString().replace(/\d/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'[d]);
}

function getToday() {
  return new Date().toISOString().split('T')[0];
}

function getPersianDate() {
  return new Date().toLocaleDateString('fa-IR', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

// ==================== THEME ====================
function toggleTheme() {
  state.theme = state.theme === 'light' ? 'dark' : 'light';
  applyTheme();
  saveToStorage();
}

function applyTheme() {
  document.documentElement.setAttribute('data-theme', state.theme);
  const toggle = document.getElementById('themeToggle');
  const icon = document.getElementById('themeIcon');
  if (toggle) toggle.classList.toggle('active', state.theme === 'dark');
  if (icon) icon.textContent = state.theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
}

// ==================== NAVIGATION ====================
function goTo(page, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  if (el) el.classList.add('active');
  
  document.getElementById('appMain').scrollTop = 0;
  
  if (page === 'today') updateToday();
  if (page === 'week') updateWeek();
  if (page === 'habits') updateHabits();
  if (page === 'settings') updateSettings();
}

function scrollToSection(id) {
  document.getElementById('sec-' + id)?.scrollIntoView({ behavior: 'smooth' });
}

function showApp() {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-today').classList.add('active');
  document.getElementById('bottomNav').style.display = 'flex';
  document.getElementById('appHeader').style.display = 'flex';
  updateToday();
}

// ==================== MODALS ====================
function showWelcomeModal() {
  document.getElementById('welcomeModal').classList.add('show');
}

function closeWelcomeModal() {
  document.getElementById('welcomeModal').classList.remove('show');
  if (state.onboardingDone) showApp();
}

function showBackupModal() {
  document.getElementById('backupModal').classList.add('show');
}

function closeBackupModal() {
  document.getElementById('backupModal').classList.remove('show');
}

// ==================== ONBOARDING ====================
let currentStep = 1;

function startOnboarding() {
  document.getElementById('page-start').classList.remove('active');
  document.getElementById('page-onboarding').classList.add('active');
}

function nextStep(step) {
  if (step === 2) {
    state.user.name = document.getElementById('userName').value.trim() || 'Ø¯ÙˆØ³Øª';
  }
  if (step === 3) {
    state.user.values = [...temp.values];
  }
  if (step === 4) {
    state.user.roles = [...temp.roles];
  }
  if (step === 5) {
    updateIdentityPreview();
  }
  
  document.getElementById('step-' + currentStep).classList.add('hidden');
  document.getElementById('step-' + step).classList.remove('hidden');
  currentStep = step;
  updateStepDots();
}

function prevStep(step) {
  document.getElementById('step-' + currentStep).classList.add('hidden');
  document.getElementById('step-' + step).classList.remove('hidden');
  currentStep = step;
  updateStepDots();
}

function updateStepDots() {
  document.querySelectorAll('.step-dot').forEach((dot, i) => {
    dot.classList.remove('active', 'done');
    if (i + 1 < currentStep) dot.classList.add('done');
    if (i + 1 === currentStep) dot.classList.add('active');
  });
}

function toggleChip(el, type) {
  el.classList.toggle('selected');
  const value = el.dataset.v;
  if (el.classList.contains('selected')) {
    if (!temp[type].includes(value)) temp[type].push(value);
  } else {
    temp[type] = temp[type].filter(v => v !== value);
  }
}

function addCustomValue() {
  const input = document.getElementById('customValue');
  const value = input.value.trim();
  if (value && !temp.values.includes(value)) {
    temp.values.push(value);
    const chip = document.createElement('span');
    chip.className = 'chip selected';
    chip.dataset.v = value;
    chip.textContent = 'âœ¨ ' + value;
    chip.onclick = function() { toggleChip(this, 'values'); };
    document.getElementById('valuesChips').appendChild(chip);
    input.value = '';
  }
}

function addCustomRole() {
  const input = document.getElementById('customRole');
  const value = input.value.trim();
  if (value && !temp.roles.includes(value)) {
    temp.roles.push(value);
    const chip = document.createElement('span');
    chip.className = 'chip selected';
    chip.dataset.v = value;
    chip.textContent = 'ğŸ­ ' + value;
    chip.onclick = function() { toggleChip(this, 'roles'); };
    document.getElementById('rolesChips').appendChild(chip);
    input.value = '';
  }
}

function selectEnergy(energy, el) {
  document.querySelectorAll('.time-block').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
  state.user.energy = energy;
}

function updateIdentityPreview() {
  document.getElementById('pvName').textContent = state.user.name;
  document.getElementById('pvValues').textContent = state.user.values.slice(0, 2).join(' Ùˆ ') || 'Ù¾ÛŒØ´Ø±ÙØª';
  document.getElementById('pvRoles').textContent = state.user.roles.slice(0, 2).join(' Ùˆ ') || 'Ø®ÙˆØ¯Ù…';
  
  state.user.identity = `Ù…Ù† ${state.user.name} Ù‡Ø³ØªÙ… Ú©Ù‡ Ø¨Ø±Ø§Ù… ${state.user.values.slice(0,2).join(' Ùˆ ')} Ù…Ù‡Ù…Ù‡ Ùˆ Ø¯Ø± Ù†Ù‚Ø´ ${state.user.roles.slice(0,2).join(' Ùˆ ')} Ù‚Ø¯Ù…â€ŒØ¨Ù‡â€ŒÙ‚Ø¯Ù… Ù¾ÛŒØ´ Ù…ÛŒâ€ŒØ±Ù….`;
  document.getElementById('identityText').value = state.user.identity;
}

function completeOnboarding() {
  state.user.identity = document.getElementById('identityText').value;
  state.onboardingDone = true;
  state.lastActive = getToday();
  state.streak = 1;
  state.totalDays = 1;
  state.activeDates = [getToday()];
  saveToStorage();
  
  document.getElementById('page-onboarding').classList.remove('active');
  showApp();
  toast('Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ! ğŸ‰');
  confetti();
}

// ==================== TODAY ====================
function updateToday() {
  document.getElementById('greetName').textContent = state.user.name;
  document.getElementById('todayDate').textContent = getPersianDate();
  document.getElementById('streakNum').textContent = toPersian(state.streak) + ' ğŸ”¥';
  
  const todayTasks = state.tasks.filter(t => t.date === getToday());
  const doneTasks = todayTasks.filter(t => t.completed);
  
  document.getElementById('statDone').textContent = toPersian(doneTasks.length);
  document.getElementById('statTotal').textContent = toPersian(todayTasks.length);
  document.getElementById('statDays').textContent = toPersian(state.totalDays);
  
  const weekStart = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
  const weekTasks = state.tasks.filter(t => t.date >= weekStart);
  const weekDone = weekTasks.filter(t => t.completed).length;
  const weekPercent = weekTasks.length ? Math.round(weekDone / weekTasks.length * 100) : 0;
  document.getElementById('statWeek').textContent = toPersian(weekPercent) + 'Ùª';
  
  // Progress
  const percent = todayTasks.length ? Math.round(doneTasks.length / todayTasks.length * 100) : 0;
  document.getElementById('progPercent').textContent = toPersian(percent) + 'Ùª';
  document.getElementById('progFill').style.width = percent + '%';
  
  // Role select
  const roleSelect = document.getElementById('taskRole');
  roleSelect.innerHTML = '<option value="">Ù†Ù‚Ø´</option>';
  state.user.roles.forEach(r => {
    roleSelect.innerHTML += `<option value="${r}">${r}</option>`;
  });
  
  renderBrainDump();
  renderTasks();
  updateStreak();
}

// Brain Dump
function renderBrainDump() {
  const container = document.getElementById('brainList');
  if (!state.brainDump.length) {
    container.innerHTML = '<div class="empty-state py-4"><div class="empty-state-icon">ğŸ§ </div><div class="empty-state-text">Ø°Ù‡Ù†Øª Ø®Ø§Ù„ÛŒÙ‡!</div></div>';
    return;
  }
  container.innerHTML = state.brainDump.map((item, i) => `
    <div class="brain-item">
      <span class="brain-item-text">${item}</span>
      <div class="brain-item-actions">
        <span class="brain-item-btn" onclick="brainToTask(${i})">ğŸ¯</span>
        <span class="brain-item-btn" onclick="deleteBrain(${i})">âœ•</span>
      </div>
    </div>
  `).join('');
}

function addBrain() {
  const input = document.getElementById('brainInput');
  const value = input.value.trim();
  if (!value) return;
  
  state.brainDump.push(value);
  saveToStorage();
  input.value = '';
  renderBrainDump();
}

function deleteBrain(index) {
  state.brainDump.splice(index, 1);
  saveToStorage();
  renderBrainDump();
}

function brainToTask(index) {
  document.getElementById('taskTitle').value = state.brainDump[index];
  state.brainDump.splice(index, 1);
  saveToStorage();
  renderBrainDump();
  document.getElementById('sec-plan').scrollIntoView({ behavior: 'smooth' });
  toast('Ø­Ø§Ù„Ø§ Ú©Ø§Ø±Ø´ Ú©Ù†! ğŸ¯');
}

// Tasks
function renderTasks() {
  const container = document.getElementById('tasksList');
  const todayTasks = state.tasks.filter(t => t.date === getToday());
  
  if (!todayTasks.length) {
    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ¯</div><div class="empty-state-text">Ù‡Ù†ÙˆØ² Ú©Ø§Ø±ÛŒ Ù†Ø¯Ø§Ø±ÛŒ</div></div>';
    return;
  }
  
  const blockIcons = { morning: 'ğŸŒ…', afternoon: 'â˜€ï¸', evening: 'ğŸŒ™' };
  
  container.innerHTML = todayTasks.map(task => {
    const subtasksHtml = task.subtasks?.length ? `
      <div class="subtasks">
        ${task.subtasks.map((sub, i) => `
          <div class="subtask-item ${sub.done ? 'text-tertiary' : ''}">
            <div class="subtask-checkbox ${sub.done ? 'checked' : ''}" onclick="toggleSubtask('${task.id}',${i})">${sub.done ? 'âœ“' : ''}</div>
            <span style="${sub.done ? 'text-decoration:line-through' : ''}">${sub.text}</span>
          </div>
        `).join('')}
      </div>
    ` : '';
    
    return `
      <div class="task-item ${task.completed ? 'completed' : ''}">
        <div class="checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask('${task.id}')">${task.completed ? 'âœ“' : ''}</div>
        <div class="task-content">
          <div class="task-title">${task.title}</div>
          <div class="task-meta">
            ${task.role ? `<span class="tag">${task.role}</span>` : ''}
            <span class="tag blue">${blockIcons[task.block]} ${toPersian(task.adjusted)} Ø¯Ù‚ÛŒÙ‚Ù‡</span>
          </div>
          ${subtasksHtml}
          <div class="subtask-add mt-3">
            <input type="text" id="sub-${task.id}" placeholder="Ù‚Ø¯Ù… Ú©ÙˆÚ†Ú© Ø¨Ø¹Ø¯ÛŒ..." class="input flex-1" onkeypress="if(event.key==='Enter')addSubtask('${task.id}')">
            <button onclick="addSubtask('${task.id}')" class="btn btn-secondary btn-sm">+</button>
          </div>
        </div>
        <span class="task-delete" onclick="deleteTask('${task.id}')">âœ•</span>
      </div>
    `;
  }).join('');
  
  // Limit warning
  const atLimit = todayTasks.length >= state.user.maxTasks;
  document.getElementById('addTaskBtn').disabled = atLimit;
  document.getElementById('addTaskBtn').style.opacity = atLimit ? '0.5' : '1';
  document.getElementById('taskLimit').classList.toggle('hidden', !atLimit);
}

function addTask() {
  const title = document.getElementById('taskTitle').value.trim();
  if (!title) return;
  
  const todayTasks = state.tasks.filter(t => t.date === getToday());
  if (todayTasks.length >= state.user.maxTasks) return;
  
  const time = parseInt(document.getElementById('taskTime').value);
  
  state.tasks.push({
    id: Date.now().toString(),
    title,
    role: document.getElementById('taskRole').value,
    time,
    adjusted: Math.round(time * 1.5),
    block: document.getElementById('taskBlock').value,
    completed: false,
    date: getToday(),
    subtasks: []
  });
  
  saveToStorage();
  document.getElementById('taskTitle').value = '';
  updateToday();
}

function toggleTask(id) {
  const task = state.tasks.find(t => t.id === id);
  if (task) {
    task.completed = !task.completed;
    saveToStorage();
    updateToday();
    if (task.completed) confetti();
  }
}

function deleteTask(id) {
  state.tasks = state.tasks.filter(t => t.id !== id);
  saveToStorage();
  updateToday();
}

function addSubtask(taskId) {
  const input = document.getElementById('sub-' + taskId);
  const text = input.value.trim();
  if (!text) return;
  
  const task = state.tasks.find(t => t.id === taskId);
  if (task) {
    if (!task.subtasks) task.subtasks = [];
    task.subtasks.push({ text, done: false });
    saveToStorage();
    input.value = '';
    renderTasks();
  }
}

function toggleSubtask(taskId, index) {
  const task = state.tasks.find(t => t.id === taskId);
  if (task?.subtasks[index]) {
    task.subtasks[index].done = !task.subtasks[index].done;
    saveToStorage();
    renderTasks();
  }
}

function updateStreak() {
  const today = getToday();
  const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString().split('T')[0];
  
  if (!state.activeDates.includes(today)) {
    state.activeDates.push(today);
    state.totalDays++;
  }
  
  if (state.lastActive === yesterday) {
    state.streak++;
    state.lastActive = today;
  } else if (state.lastActive !== today) {
    state.streak = 1;
    state.lastActive = today;
  }
  
  saveToStorage();
}

function saveReview() {
  state.reviews.push({
    date: getToday(),
    good: document.getElementById('revGood').value,
    better: document.getElementById('revBetter').value,
    tomorrow: document.getElementById('revTomorrow').value
  });
  saveToStorage();
  
  document.getElementById('revGood').value = '';
  document.getElementById('revBetter').value = '';
  document.getElementById('revTomorrow').value = '';
  
  toast('Ù…Ø±ÙˆØ± Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯! ğŸŒŸ');
}

// ==================== WEEK ====================
function updateWeek() {
  const weekStart = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
  const weekTasks = state.tasks.filter(t => t.date >= weekStart);
  const doneTasks = weekTasks.filter(t => t.completed);
  const uniqueDays = [...new Set(weekTasks.map(t => t.date))].length;
  const percent = weekTasks.length ? Math.round(doneTasks.length / weekTasks.length * 100) : 0;
  
  document.getElementById('wkDone').textContent = toPersian(doneTasks.length);
  document.getElementById('wkPlan').textContent = toPersian(weekTasks.length);
  document.getElementById('wkDays').textContent = toPersian(uniqueDays);
  document.getElementById('wkPercent').textContent = toPersian(percent) + 'Ùª';
  
  // Role distribution
  const roles = {};
  weekTasks.forEach(t => {
    const role = t.role || 'Ø¨Ø¯ÙˆÙ† Ù†Ù‚Ø´';
    roles[role] = (roles[role] || 0) + 1;
  });
  
  document.getElementById('rolesDist').innerHTML = Object.entries(roles)
    .map(([role, count]) => `<span class="tag">${role}: ${toPersian(count)}</span>`)
    .join('');
  
  // History
  renderHistory();
}

function saveWeekReview() {
  state.weeklyReviews.push({
    date: getToday(),
    highlights: document.getElementById('wkHighlight').value,
    obstacles: [...temp.obstacles],
    experiment: document.getElementById('wkExperiment').value
  });
  saveToStorage();
  
  temp.obstacles = [];
  document.querySelectorAll('#obstacleChips .chip').forEach(c => c.classList.remove('selected'));
  document.getElementById('wkHighlight').value = '';
  document.getElementById('wkExperiment').value = '';
  
  toast('Ù…Ø±ÙˆØ± Ù‡ÙØªÚ¯ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯! ğŸ“Š');
}

function renderHistory() {
  const container = document.getElementById('reviewHistory');
  const recent = state.reviews.slice(-5).reverse();
  
  if (!recent.length) {
    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“œ</div><div class="empty-state-text">Ù‡Ù†ÙˆØ² Ù…Ø±ÙˆØ±ÛŒ Ù†Ø¯Ø§Ø±ÛŒ</div></div>';
    return;
  }
  
  container.innerHTML = recent.map(r => `
    <div class="brain-item" style="flex-direction:column;align-items:flex-start">
      <div class="text-xs text-tertiary mb-2">${r.date}</div>
      ${r.good ? `<p class="text-sm"><strong>âœ…</strong> ${r.good}</p>` : ''}
      ${r.tomorrow ? `<p class="text-sm"><strong>ğŸ’¡</strong> ${r.tomorrow}</p>` : ''}
    </div>
  `).join('');
}

// ==================== HABITS ====================
function updateHabits() {
  renderHabits();
  renderIfThens();
  renderWoops();
}

function renderHabits() {
  const container = document.getElementById('habitsList');
  if (!state.habits.length) {
    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ”—</div><div class="empty-state-text">Ø¹Ø§Ø¯ØªÛŒ Ù†Ø¯Ø§Ø±ÛŒ</div></div>';
    return;
  }
  container.innerHTML = state.habits.map(h => `
    <div class="habit-card">
      <span class="habit-card-delete" onclick="deleteHabit('${h.id}')">âœ•</span>
      <p class="text-sm"><strong>Ø¨Ø¹Ø¯ Ø§Ø²</strong> ${h.anchor}</p>
      <p class="text-sm"><strong>ÙÙ‚Ø·</strong> ${h.behavior}</p>
    </div>
  `).join('');
}

function addHabit() {
  const anchor = document.getElementById('habitAnchor').value.trim();
  const behavior = document.getElementById('habitBehavior').value.trim();
  if (!anchor || !behavior) {
    toast('Ù‡Ø± Ø¯Ùˆ ÙÛŒÙ„Ø¯ Ø±Ùˆ Ù¾Ø± Ú©Ù†');
    return;
  }
  
  state.habits.push({
    id: Date.now().toString(),
    anchor,
    behavior
  });
  saveToStorage();
  
  document.getElementById('habitAnchor').value = '';
  document.getElementById('habitBehavior').value = '';
  updateHabits();
  toast('Ø¹Ø§Ø¯Øª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯! ğŸŒ±');
}

function deleteHabit(id) {
  state.habits = state.habits.filter(h => h.id !== id);
  saveToStorage();
  updateHabits();
}

function renderIfThens() {
  const container = document.getElementById('ifThenList');
  if (!state.ifThens.length) {
    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">âš¡</div><div class="empty-state-text">Ù‚Ø§Ù†ÙˆÙ†ÛŒ Ù†Ø¯Ø§Ø±ÛŒ</div></div>';
    return;
  }
  container.innerHTML = state.ifThens.map(r => `
    <div class="habit-card" style="background:linear-gradient(135deg,#EDE9FE,#F5F3FF);border-color:#C4B5FD">
      <span class="habit-card-delete" onclick="deleteIfThen('${r.id}')">âœ•</span>
      <p class="text-sm"><strong>Ø§Ú¯Ø±</strong> ${r.ifC}</p>
      <p class="text-sm"><strong>Ø¢Ù†Ú¯Ø§Ù‡</strong> ${r.thenA}</p>
    </div>
  `).join('');
}

function addIfThen() {
  const ifC = document.getElementById('ifCond').value.trim();
  const thenA = document.getElementById('thenAct').value.trim();
  if (!ifC || !thenA) {
    toast('Ù‡Ø± Ø¯Ùˆ ÙÛŒÙ„Ø¯ Ø±Ùˆ Ù¾Ø± Ú©Ù†');
    return;
  }
  
  state.ifThens.push({
    id: Date.now().toString(),
    ifC,
    thenA
  });
  saveToStorage();
  
  document.getElementById('ifCond').value = '';
  document.getElementById('thenAct').value = '';
  updateHabits();
  toast('Ù‚Ø§Ù†ÙˆÙ† Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯! âš¡');
}

function deleteIfThen(id) {
  state.ifThens = state.ifThens.filter(r => r.id !== id);
  saveToStorage();
  updateHabits();
}

function renderWoops() {
  const container = document.getElementById('woopList');
  if (!state.woops?.length) {
    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">â­</div><div class="empty-state-text">Ù‡Ø¯ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒ</div></div>';
    return;
  }
  container.innerHTML = state.woops.map(w => `
    <div class="woop-card">
      <p><strong>ğŸŒŸ</strong> ${w.wish}</p>
      ${w.outcome ? `<p><strong>âœ¨</strong> ${w.outcome}</p>` : ''}
      ${w.obstacle ? `<p><strong>ğŸš§</strong> ${w.obstacle}</p>` : ''}
      <p><strong>ğŸ“‹</strong> ${w.plan}</p>
      <div style="text-align:left;margin-top:8px">
        <span class="text-xs text-tertiary" style="cursor:pointer" onclick="deleteWoop('${w.id}')">Ø­Ø°Ù</span>
      </div>
    </div>
  `).join('');
}

function addWoop() {
  const wish = document.getElementById('woopW').value.trim();
  const plan = document.getElementById('woopP').value.trim();
  if (!wish || !plan) {
    toast('Ø¢Ø±Ø²Ùˆ Ùˆ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù„Ø§Ø²Ù…Ù‡');
    return;
  }
  
  if (!state.woops) state.woops = [];
  state.woops.push({
    id: Date.now().toString(),
    wish,
    outcome: document.getElementById('woopO').value.trim(),
    obstacle: document.getElementById('woopOb').value.trim(),
    plan
  });
  saveToStorage();
  
  ['woopW', 'woopO', 'woopOb', 'woopP'].forEach(id => document.getElementById(id).value = '');
  updateHabits();
  toast('Ù‡Ø¯Ù Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯! â­');
}

function deleteWoop(id) {
  state.woops = state.woops.filter(w => w.id !== id);
  saveToStorage();
  updateHabits();
}

// ==================== AI ====================
function generatePrompt() {
  const weekStart = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
  const weekTasks = state.tasks.filter(t => t.date >= weekStart);
  const doneTasks = weekTasks.filter(t => t.completed);
  const notDone = weekTasks.filter(t => !t.completed);
  
  const prompt = `Ø³Ù„Ø§Ù…! Ù…ÛŒâ€ŒØ®ÙˆØ§Ù… Ú©Ù…Ú©Ù… Ú©Ù†ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø¨Ù‡ØªØ±ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù….

ğŸ“Š Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ù…Ù†:
- Ø§Ø³Ù…: ${state.user.name}
- Ø§Ø±Ø²Ø´â€ŒÙ‡Ø§: ${state.user.values.join('ØŒ ') || '-'}
- Ù†Ù‚Ø´â€ŒÙ‡Ø§: ${state.user.roles.join('ØŒ ') || '-'}
- Ø§Ù†Ø±Ú˜ÛŒ: ${state.user.energy === 'morning' ? 'ØµØ¨Ø­' : state.user.energy === 'afternoon' ? 'Ø¨Ø¹Ø¯Ø§Ø²Ø¸Ù‡Ø±' : 'Ø´Ø¨'}

ğŸ“ˆ Ø¢Ù…Ø§Ø± Ù‡ÙØªÙ‡:
- Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø´Ø¯Ù‡: ${weekTasks.length}
- Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡: ${doneTasks.length}
- Ù…ÙˆÙÙ‚ÛŒØª: ${weekTasks.length ? Math.round(doneTasks.length/weekTasks.length*100) : 0}Ùª
- Ø±ÙˆØ² Ù…ØªÙˆØ§Ù„ÛŒ: ${state.streak}

âœ… Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡: ${doneTasks.map(t => t.title).join('ØŒ ') || '-'}
âŒ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ù†Ø´Ø¯Ù‡: ${notDone.map(t => t.title).join('ØŒ ') || '-'}

ğŸ”— Ø¹Ø§Ø¯Øªâ€ŒÙ‡Ø§: ${state.habits.map(h => `Ø¨Ø¹Ø¯ Ø§Ø² ${h.anchor} â†’ ${h.behavior}`).join(' | ') || '-'}
âš¡ Ù‚ÙˆØ§Ù†ÛŒÙ†: ${state.ifThens.map(r => `Ø§Ú¯Ø± ${r.ifC} â†’ ${r.thenA}`).join(' | ') || '-'}

ğŸ§  Ø°Ù‡Ù†Ù…: ${state.brainDump.join('ØŒ ') || '-'}

Ù„Ø·ÙØ§Ù‹ ØªØ­Ù„ÛŒÙ„ Ú©Ù† Ùˆ Û³ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¹Ù…Ù„ÛŒ Ø¨Ø¯Ù‡.`;

  document.getElementById('promptText').textContent = prompt;
  document.getElementById('promptContainer').classList.remove('hidden');
  toast('Ù¾Ø±Ø§Ù…Ù¾Øª Ø¢Ù…Ø§Ø¯Ù‡! ğŸ¤–');
}

function copyPrompt() {
  const text = document.getElementById('promptText').textContent;
  navigator.clipboard.writeText(text).then(() => {
    toast('Ú©Ù¾ÛŒ Ø´Ø¯! ğŸ“‹');
  });
}

// ==================== SETTINGS ====================
function updateSettings() {
  document.getElementById('setName').value = state.user.name;
  document.getElementById('setMax').value = state.user.maxTasks;
  document.getElementById('setValues').textContent = state.user.values.join('ØŒ ') || '-';
  document.getElementById('setRoles').textContent = state.user.roles.join('ØŒ ') || '-';
  document.getElementById('setIdentity').value = state.user.identity;
  applyTheme();
}

function saveSettings() {
  state.user.name = document.getElementById('setName').value.trim() || 'Ø¯ÙˆØ³Øª';
  state.user.maxTasks = parseInt(document.getElementById('setMax').value);
  saveToStorage();
  toast('Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯! âœ“');
  updateToday();
}

function saveIdentity() {
  state.user.identity = document.getElementById('setIdentity').value;
  saveToStorage();
  toast('Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯! âœ“');
}

function resetOnboarding() {
  if (confirm('Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯ØŸ')) {
    state.onboardingDone = false;
    saveToStorage();
    location.reload();
  }
}

function clearAll() {
  if (confirm('âš ï¸ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø¨Ø´Ù‡ØŸ')) {
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  }
}

// ==================== PWA ====================
function installApp() {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then(result => {
      if (result.outcome === 'accepted') {
        toast('Ø¯Ø± Ø­Ø§Ù„ Ù†ØµØ¨... âœ…');
      }
      deferredPrompt = null;
      hideInstallBanner();
    });
  }
}

function hideInstallBanner() {
  document.getElementById('installBanner').classList.remove('show');
  localStorage.setItem('hideInstall', 'true');
}

// ==================== CONFETTI ====================
function confetti() {
  const colors = ['#10B981', '#34D399', '#FCD34D', '#F87171', '#60A5FA', '#A78BFA'];
  for (let i = 0; i < 30; i++) {
    const c = document.createElement('div');
    c.style.cssText = `
      position: fixed;
      width: 10px;
      height: 10px;
      background: ${colors[Math.floor(Math.random() * colors.length)]};
      left: ${Math.random() * 100}%;
      top: -10px;
      border-radius: ${Math.random() > 0.5 ? '50%' : '2px'};
      z-index: 1000;
      pointer-events: none;
      animation: confetti-fall ${2 + Math.random() * 2}s linear forwards;
    `;
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 4000);
  }
}

// ==================== OFFLINE ====================
function updateOnlineStatus() {
  const bar = document.getElementById('offlineBar');
  if (navigator.onLine) {
    bar.classList.remove('show');
  } else {
    bar.classList.add('show');
  }
}

// ==================== SERVICE WORKER ====================
if ('serviceWorker' in navigator) {
  const swCode = `
    const CACHE_NAME = 'aram-planner-v1';
    self.addEventListener('install', e => {
      self.skipWaiting();
    });
    self.addEventListener('fetch', e => {
      e.respondWith(
        caches.match(e.request).then(r => r || fetch(e.request))
      );
    });
  `;
  const blob = new Blob([swCode], { type: 'application/javascript' });
  navigator.serviceWorker.register(URL.createObjectURL(blob)).catch(() => {});
}

// ==================== INIT ====================
function init() {
  loadFromStorage();
  applyTheme();
  
  // Online/Offline
  window.addEventListener('online', updateOnlineStatus);
  window.addEventListener('offline', updateOnlineStatus);
  updateOnlineStatus();
  
  // Install prompt
  window.addEventListener('beforeinstallprompt', e => {
    e.preventDefault();
    deferredPrompt = e;
    if (!localStorage.getItem('hideInstall')) {
      document.getElementById('installBanner').classList.add('show');
    }
  });
  
  // File imports
  document.getElementById('importWelcome').addEventListener('change', e => {
    if (e.target.files[0]) importFromFile(e.target.files[0]);
  });
  document.getElementById('importSettings').addEventListener('change', e => {
    if (e.target.files[0]) importFromFile(e.target.files[0]);
  });
  
  // Auto-save
  setInterval(saveToStorage, 30000);
  window.addEventListener('beforeunload', saveToStorage);
  
  // Show appropriate page
  if (state.onboardingDone) {
    showWelcomeModal();
  }
}

init();
</script>
</body>
</html>
